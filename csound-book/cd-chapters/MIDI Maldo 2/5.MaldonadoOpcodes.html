<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>Using Real-Time Csound MIDI with Windows</title>	</head>	<body bgcolor="#eeeeee">		<h1><font face="Times"><b>Using real-time Csound MIDI with Windows</b></font></h1>		<h2><font face="Times" size="2"><b>Gabriel Maldonado<br>		</b></font></h2>		<p><font face="Times" size="2">This proposal concerns the well-known sound-synthesis language Csound. Some additions have been made in order to use Csound in real-time. These additions allow a live control of the synthesis process with the Windows operating system. The aim is to give the user a powerful and low-cost workstation to produce new sounds and new music interactively and also to make live performances. Try to imagine Csound being a universal musical instrument.</font></p>		<div align="justify">			<h2><font face="Times"><b>Why Real-Time?</b></font></h2>		</div>		<div align="justify">			<p><font face="Times" size="2">Csound is one of the most famous sound-synthesis languages. At the beginning of the &#145;90s its author, Berry Vercoe, has added some MIDI oriented opcodes to use it in real-time. At that time the only machines capable to run Csound in real-time, were the Silicon Graphics and some other expensive UNIX workstations. Some years later the Intel-based PCs became fast enough to run Csound in real-time, but at first they were capable to accomplish this task only under the LINUX OS, and without any MIDI support. DOS and Windows were rigorously kept off the real-time dream.</font></p>			<p><font face="Times" size="2">Now low-latency AUDIO support, MIDI support and many MIDI opcodes have been implemented under Windows, to allow the user to control Csound as it could be a sort of musical instrument.</font></p>			<p><font face="Times" size="2">What is the difference in using Csound in real-time rather than using it in deferred-time? For what reason should a composer prefer to use it in real-time? The more trivial reason is that running Csound redirecting its output to the audio-DACs (instead of writing the output on a file) saves both space on the hard-disk and time to listen to the result; it can be quite useful when composing a piece, because normally a lot of tests are necessary to achieve the composer expectations. In this case real-time is not essential, it is only more convenient.</font></p>			<p><font face="Times" size="2">But there are cases in which real-time is indispensable. What about if a composer decides to make a piece in which some musical parameters are fixed, but other ones are modifiable during the performance? And if he wants to control a MIDI synthesiser by means of his favourite Csound algorithm or pitch tables? And if a performer needs a synthesiser capable of completely new synthesis methods, which aren&#146;t implemented in any hardware synths yet? Real-time becomes also necessary when some non-intuitive parameters of the composition need to be defined accurately by means of the composer&#146;s ears.</font></p>			<h2><font face="Times"><b>Initialisation Parameters and Continuous Parameters from the Real-Time Point of View</b></font></h2>			<p><font face="Times" size="2">In Csound there are three kinds of signals:<i><b> i-rate</b></i> (initialisation stage variables), <i><b>k-rate</b></i> (control rate variables) and <i><b>a-rate</b></i> (audio rate variables) signals.</font></p>			<p><font face="Times" size="2">The<i> k-rate</i> and<i><b> </b>a-rate</i> signals can be considered <i>continuous</i> from the user point of view. This means that these two kinds of signals can be thought as slanting-straight lines or curves (Fig.1 a,b,c).</font></p>			<p><font face="Times" size="2">&nbsp;<img height="300" width="421" src="fig1.gif"></font></p>			<p><font face="Times" size="2">The<i> k-rate</i> signals are normally used to control the behaviour of a generator unit or a modifier unit. Sometimes it is recommended to use <i>a-rate</i> for control signals too, for example when the amplitude envelope of an audio generator has got fast transients, or when an LFO must control a flanger delay. In these cases audible distortion occurs if <i>k-rate</i> is used, so it is necessary to use <i>a-rate</i>.</font></p>			<p><font face="Times" size="2">On the other hand, <i>i-rate</i> values cannot be considered exactly as signals. In fact they remain constant for the entire duration of a Csound note event. If one imagined them in a graph, he could think them as a stepped picture (Fig.2). Each step refers to an<i> i-statement</i> of Csound score or to a note-on MIDI message recognised by the MIDI IN port.</font></p>			<p><font face="Times" size="2"><img height="383" width="526" src="fig2.gif"></font></p>			<p><font face="Times" size="2">Further, <i>i-rate</i>, <i>k-rate</i> and <i>a-rate</i> signals can be considered in two different ways from Csound instruments point of view:</font></p>			<p><font face="Times" size="2"><i><b>internally-generated</b></i></font></p>			<p><font face="Times" size="2"><i><b>externally-received</b></i></font></p>			<p><font face="Times" size="2">&nbsp;</font></p>			<p><font face="Times" size="2">For example, Csound score <i>p-fields</i> are <i>externally-received</i> <i>i-rate</i> values, because they are not defined inside the instrument block, but externally, in the score. Global <i>k-rate</i> and <i>a-rate</i> signals are <i>internally-generated</i> by an instrument, but they can be considered as <i>externally-received</i> from the target-instruments point of view. Obviously incoming MIDI control-change messages are <i>externally-received</i> signals. Signals sent to the MIDI OUT port are <i>internally-generated</i>.</font></p>			<p><font face="Times" size="2"><i>Externally-received</i> <i>k-rate</i> signals will be named <i><b>continuous parameters</b></i>, and <i>externally-received i-rate</i> values <i><b>init parameters</b></i>. <i>a-rate</i> signals will not be taken into account, because normally they are not used as real-time control signals, but they are as audio signals. So it is possible to draw a table:</font></p>			<p><font face="Times" size="2">&nbsp;</font></p>		</div>		<p>		<table border="0" cellspacing="2" cellpadding="3" width="471">			<tr>				<td width="19%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>SIGNALS</b></font></div>				</td>				<td width="7%" valign="top" bgcolor="white">&nbsp;</td>				<td width="13%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>Initialisation values</b></font></div>				</td>				<td width="11%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>Control signals</b></font></div>				</td>				<td width="8%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>Audio signals</b></font></div>				</td>				<td width="13%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>Continuous parameters</b></font></div>				</td>				<td width="13%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>Init parameters</b></font></div>				</td>				<td width="8%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>MIDI input</b></font></div>				</td>				<td width="8%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2"><b>MIDI output</b></font></div>				</td>			</tr>			<tr>				<td width="19%" valign="top" bgcolor="white">&nbsp;</td>				<td width="7%" valign="top">					<div align="justify">						<font face="Times" size="2">i-rate</font></div>				</td>				<td width="13%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>				<td width="11%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="8%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>			</tr>			<tr>				<td width="19%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2">internally-generated</font></div>				</td>				<td width="7%" valign="top">					<div align="justify">						<font face="Times" size="2">k-rate</font></div>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="11%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="8%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>			</tr>			<tr>				<td width="19%" valign="top" bgcolor="white">&nbsp;</td>				<td width="7%" valign="top">					<div align="justify">						<font face="Times" size="2">a-rate</font></div>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="11%" valign="top">					<center>						<font face="Times" size="2">sometimes<sup>1</sup> </font></center>				</td>				<td width="8%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="19%" valign="top" bgcolor="white">&nbsp;</td>				<td width="7%" valign="top">					<div align="justify">						<font face="Times" size="2">i-rate</font></div>				</td>				<td width="13%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>				<td width="11%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="13%" valign="top">					<center>						<font face="Times" size="2">yes<sup>2</sup></font></center>				</td>				<td width="8%" valign="top">					<center>						<font face="Times" size="2">yes<sup>2</sup></font></center>				</td>				<td width="8%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="19%" valign="top" bgcolor="white">					<div align="justify">						<font face="Times" size="2">externally - received </font></div>				</td>				<td width="7%" valign="top">					<div align="justify">						<font face="Times" size="2">k-rate</font></div>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="11%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="13%" valign="top">					<center>						<font face="Times" size="2">yes<sup>2</sup></font></center>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="8%" valign="top">					<center>						<font face="Times" size="2">yes<sup>2</sup></font></center>				</td>				<td width="8%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="19%" valign="top" bgcolor="white">&nbsp;</td>				<td width="7%" valign="top">					<div align="justify">						<font face="Times" size="2">a-rate</font></div>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="11%" valign="top">&nbsp;</td>				<td width="8%" valign="top">					<center>						<font face="Times" size="2">yes</font></center>				</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<div align="justify">			<p><font face="Times" size="1"><b>note 1:</b><i> Sometimes a-rate signals are used to control the amplitude envelope of an audio generator to avoid distortion in fast transients when k-rate is very low.</i></font></p>			<p><font face="Times" size="1"><b>note 2: </b><i>Signals received by the MIDI-input opcodes operate at i-rate and k-rate. Note-on messages are init-parameters. Control-change, aftertouch and pitch-bend messages are continuous parameters.</i></font></p>			<p><font face="Times" size="2">Notice also that signals received by the MIDI-input opcodes operate at <i>i-rate</i> and <i>k-rate</i>. Note-on messages <i>are init-parameters</i>, whereas control-change, aftertouch and pitch-bend messages are <i>continuous parameters</i>.</font></p>			<p><font face="Times"><b>&nbsp;</b></font></p>			<h2><font face="Times"><b>SA and MA Instruments</b></font></h2>			<p><font face="Times" size="2">A running instance of a Csound-orchestra&#146;s instrument can be activated in two ways: by the score and by a MIDI note-on message. So there are two kinds of instruments:</font></p>			<p><font face="Times" size="2">&nbsp;</font></p>			<p><font face="Times" size="2"><i><b>SA </b></i><b>Instruments</b> (Score Activated instruments)</font></p>			<p><font face="Times" size="2"><i><b>MA </b></i><b>Instruments</b> (MIDI Activated instruments)</font></p>			<p><font face="Times" size="2"><i>MA</i> and <i>SA</i> instruments can coexist in the same Csound orchestra. If an orchestra contains only <i>MA</i> instruments, and function tables are not used (for example when using the &#145;<i>pluck&#146;</i> opcode to produce the sound), a Csound score could be an almost empty file. In that case, the only statement which must be present in the score is the <i><b>f0 </b></i>statement, followed by the action time (which must be equal to the total duration of the performance). This statement is required to avoid a zero-seconds duration of the real-time session.</font></p>			<p><font face="Times" size="2"><i><b>MA</b></i><b> instruments</b> can contain the following Csound opcodes (whereas <i><b>SA</b></i><b> instruments</b> cannot):</font></p>			<p><font face="Times" size="2"><i>notnum, veloc, cpsmidi, cpsmidib, cpsmidib, octmidi, octmidib, octmidib, pchmidi, pchmidib, pchmidib, ampmidi, aftouch, chpress, pchbend, midictrl, midictrl, midictrlsc, imidic7, midic7, imidic14, midic14, imidic21, midic21</i></font></p>			<p><font face="Times" size="2">Notice that none of these opcode contains MIDI channel as an argument. If one of these opcodes is included into an <b>SA instrument</b>, unpredictable errors could occur.&nbsp;</font></p>			<p><font face="Times" size="2">In most cases the midi-channel number of a note-on or control-change message is the same as the instr number to be activated, however they can be reassigned by means of the <i><b>massign</b></i> opcode. If <i>massign</i> is not used, <i>MA</i> instruments must be numbered 1 to 16.</font></p>			<p><font face="Times" size="2">As in the following MIDI-oriented opcodes an input argument with MIDI channel information is present, they can be used in <i><b>SA</b></i><b> instruments</b>:</font></p>			<p><font face="Times" size="2"><i>ictrl7, ctrl7, ictrl14, ctrl14, ictrl21, ctrl21, chanctrl, chanctrl, initc7, initc14, initc21, slider8, slider16, slider8f, slider16f, islider8, islider16.</i></font></p>			<p><font face="Times" size="2"><i>SA</i> and <i>MA</i> instruments can cooperate in the same orchestra. For example, an <i>SA</i> instrument can contain several instances of &#145;<i>ctrl7&#146;</i> opcode, each one defining a different <i>continuous-parameter. </i>Each parameter is stored in a global variable. So the corresponding <i>continuous-parameter</i> is shared by all the instances of the <i>MA</i> instrument. It is a sort of sending/receiving process inside the same Csound orchestra: performer actions are received by the MIDI-IN port; an <i>SA</i> instrument containing some midi opcodes transforms these messages in global variables; these global variables (which are the actual <i>continuous-parameters</i>) are read by an <i>MA</i> instrument. In this case, the <i>SA-</i>instrument-instance&#146;s life begins at the start of Csound and lasts all the duration of the real-time session, whereas <i>MA-</i>instrument-instances&#146;s action-times and durations depend on the performer&#146;s actions.</font></p>			<h2>			<h2><font face="Times"><b>Four different ways to use Csound in Real-Time</b></font></h2>			</h2>			<p><font face="Times" size="2">The first way can be considered as the most trivial one. A normal orchestra contains only <i>SA</i> instruments and no parameters are modified during the performance, because all the informations are contained in the orchestra/score pair. No MIDI opcodes are used in this case, and sound output is identical to that of the wave-file produced by running a deferred-time Csound session with the same orchestra/score pair. This way can be useful to reduce the waiting time of wave-file processing and to eliminate the necessity of a big hard-disk storage space, but in every respect this method is identical to deferred-time by the hearing point of view.&nbsp;</font></p>			<p><font face="Times" size="2">The second way is the opposite to the first. According to this way, it is possible to consider Csound a MIDI synthesiser (the most powerful synth in the world!). This synth can be connected to a MIDI master-keyboard for a piano-like performance; furthermore it is possible to play Csound with controllers different from a piano keyboard, such as wind controllers, guitar controllers, drum controllers etc. In this case no <i>p-fields</i> are present in the score. All the <i>init</i> and <i>continuous parameters</i> are received via MIDI. Each note is activated by a MIDI note-on message and deactivated by a note-off message. So <i>init parameters</i> are defined by the informations contained in a note-on message: the orchestra instrument number is selected by the MIDI channel, the MIDI note-number and the velocity can be used to set two additional <i>init parameters </i>(this task can be accomplished by using the <i>notnum, cpsmidi, octmidi, pchmidi, veloc </i>and<i> ampmidi </i>opcodes)<i>. </i>Other <i>init parameters</i> can be set by sampling and holding the current status of Csound controller array at the instr initialisation stage (this task can be accomplished by using <i>imidic7, imidic14, imidic21, ictrl7, ictrl14, ictrl21, islider8, islider16, islider32, islider64, is16b14 </i>and<i> is32b14</i> opcodes in an <i>MA</i> instrument). It is suggested to use a MIDI mixer or the VMCI program (see below for more informations on it) to control a controllers bank. It is possible to use VMCI as a synth-editor for Csound by designing an instrument with a big number of init-rate controller opcodes, each one defining a particular patch-parameter. For example, the amplitude envelope ADSR durations and levels of an instrument can be assigned to a bank of sliders. So a Csound instrument can be considered as the type of synth-algorithm used, in which each slider configuration (when using VMCI this configuration can be saved on disk) becomes the particular synth-patch that can be edited according to user taste. Continuous parameters can be modified via MIDI by gestural actions of the performer by means of devices such as control-sliders, modulation-wheels, breath-controls, pitch-wheels, aftertouch etc. (the opcodes implemented to accomplish these tasks are: <i>aftouch, chpress, pchbend, midictrl, midictrlsc, midic7, midic14, midic21, ctrl7, ctrl14, ctrl21, slider8, slider16, slider32, slider64, slider8f, slider16f, slider32f, slider64f, s16b14 </i>and<i> s32b14)</i>.&nbsp;</font></p>			<p><font face="Times" size="2">The third way to use Csound in real-time is joining SA instruments to some parameters which are modifiable in real-time by a MIDI controller during the score performance. In this case each note has its p-fields already defined in the score, but there can be some additional <i>init</i> or <i>continuous parameters</i> that can be modified at performance time. The action-time and the duration of each note are fixed, but the metronomic speed of the performance can be changed in real-time by the user. Any kind of parameter can be assigned to a live controller. This can enrich the concert performances: each time the composition will acquire a new flavour, it will never be exactly the same.&nbsp;</font></p>			<p><font face="Times" size="2">The fourth way to use Csound reminds us a little the old and cheap Casio keyboards &quot;<i>one-key-play</i>&quot; mode. In this mode, note-on messages are used to trigger the note-events, that are pulled out from a queue of note-parameter blocks stored into a table, i.e. all the <i>init-parameters</i> of each note have to be stored into a table. Note-off messages are used to deactivate a playing note. Overlapping notes, as well as polyphony are allowed. All the init parameters used in a conventional <i>SA</i> instrument can be ported to a real-time activated instrument (<i>MA</i> instrument) when using this method. I like to play Csound in this way very much, because it is possible to define a lot of very precise parameters for each note, but the activation time and the duration of each note is decided by the performer at performance time. This enables the user to control all these interpretative nuances of time such as <i>ritardando</i> and <i>accelerando</i>, very difficult to define with precision at the score-design time. Also, two additional init-values can be used to control any kind of parameter; these values are obtained by the note-number and the velocity of each note played at performance time. A section of an <i>SA</i> instrument of a standard score can be easily converted to be used with the &quot;<i>one-key-play</i>&quot; mode. The new GEN 23 function-table generator subroutine, which reads numeric values from an external ASCII file, can be used to do this job.</font></p>			<h2><font face="Times"><b>New Features</b></font></h2>			<p><font face="Times" size="2">The main features added to this Windows version of Csound are:</font></p>			<ol>				<li><font face="Times" size="2">Real-time audio input and audio output in parallel, before available only in UNIX platforms (now the <i>DirectSound</i> API functions enable a very low latency to audio output, giving the performer a short time response for gestural actions).</font>				<li><font face="Times" size="2">Real-time MIDI IN and MIDI OUT (new feature).</font>				<li><font face="Times" size="2">Command line oriented real-time output (before implemented only in UNIX platforms).</font>				<li><font face="Times" size="2">Hard-disk recording of the real-time audio output in the same machine (completely new feature).</font>				<li><font face="Times" size="2">Several real-time-oriented opcodes.</font>			</ol>		</div>	</body></html>