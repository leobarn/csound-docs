<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>&quot;MIDI Instrument Design for Real-time Performance&quot;</title>	</head>	<body bgcolor="white">		<h1><b>4. MIDI Designs for Real Time Performance</b></h1>		<h2>Gabriel Maldonado</h2>		<p>Real time control is an indispensable feature in my concept of making music. Csound is a very powerful tool, though, at least in first versions, it was a non-real time oriented synthesis language. I added some MIDI IN and OUT opcodes to make structure-generation and synthesis processes control easier. In this article I give you some examples of .orc and .sco files and a source analysis of some of these opcodes in Csound.</p>		<h3><b>New Opcodes</b></h3>		<p>In the first part of this chapter I will describe the usefulness of Csound of both MIDI IN and MIDI OUT opcodes in real time operations.</p>		<p>Why new MIDI IN opcodes? Barry Vercoe already added most MIDI IN opcodes in 1992 release of Csound. My new opcodes only support control-change messages, which are very useful for changing Instrument parameters of any kind during the real time performance. MIDI protocol supports 128 control numbers for channel. So it is possible to control in real time up to 128 different parameters in the same Csound Instrument via MIDI. For example it is possible to change insturment vibrato speed and depth, and at the same time to change amplitude, carrier/modulating ratio and modulation index in an FM intrument, as well as envelope speed and depth of other parameters. In score activated instruments it is not possible to use control-change opcodes directly because Csound crashes if you attempt to activate them by the score: instruments containing control-change opcodes can be activated only by MIDI note-on messages. However it is possible to use them to change a global variable which can be accessed by a score activated instrument. Another example of using control-change messages is to change performance tempo while a sco is executing. (The source of this example is provided below).</p>		<p>Barry Vercoe&#146;s original control-change opcodes are:</p>		<p><i>ival<b> </b></i><b>midictrl<i> </i></b><i>inum</i></p>		<p><i>kval<b> </b></i><b>midictrl<i> </i></b><i>inum</i></p>		<p>They get the current value (0 - 127) of a specified MIDI controller <i><b>inum</b></i> at <b>i</b> or <b>k</b>-rates. Unfortunately MIDI protocol only supports 7-bit-integer parameters. For this limitation I implemented new control-change opcodes. These opcodes now support:</p>		<dir>			<p>&#149; Scaling of integer MIDI values to floating point values in a user <b>k</b>-time variable minimum-maximum range</p>			<p>&#149; Raw input values remapping by means of table-interpolated indexing</p>			<p>&#149; Increased resolution up to 21-bit by joining more MIDI control numbers to control the same parameter.</p>		</dir>		<p>These new opcodes make real time orc-files shorter and easier to implement and to read by eliminating additional lines for calculating scaled parameter adjustment. For a detailed description of the syntax of these opcodes, read the appendix of this chapter titled &quot;New MIDI Opcodes Syntax .&quot;</p>		<p>&nbsp;</p>		<p><b>MIDI In-Based Instruments</b></p>		<p>In this section I give you some .orc and .sco files with real time samples of <b>(i)midicXX</b> opcodes. The first example is quite simple: an orchestra with two oscillators. The frequency of one oscillator is fixed and is determined by MIDI note-number, while the frequency of the second oscillator can vary continuously by means of MIDI controller number 1 (modulation-wheel) so the frequency ratio of the two oscillator can be adjusted at any moment by the user.</p>		<h2>Simple use of <b>midic7</b> Controlling Frequency</h2>		<p><img src="Image1.gif" width="411" height="272" align="LEFT" hspace="9"></p>		<p>&nbsp;</p>		<p><br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<b>Figure 4.1</b> Block diagram of <i>instr 401</i>, a 2 oscillator midi instrument with mod-wheel control of pitch.</p>		<p>		<table cellspacing="0" border="0" width="464">			<tr>				<td width="13%" valign="top">&nbsp;</td>				<td width="16%" valign="top"><font face="Courier" size="2">instr 401</font></td>				<td width="21%" valign="top">&nbsp;</td>				<td width="51%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">cpsmidi</font></td>				<td width="21%" valign="top">&nbsp;</td>				<td width="51%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">iamp</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">ampmidi</font></td>				<td width="21%" valign="top"><font face="Courier" size="2">2000</font></td>				<td width="51%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">ikoct</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="21%" valign="top"><font face="Courier" size="2">4</font></td>				<td width="51%" valign="top"><font face="Courier" size="2">;2 octaves transposition factor</font></td>			</tr>			<tr>				<td width="13%" valign="top">&nbsp;</td>				<td width="16%" valign="top">&nbsp;</td>				<td width="21%" valign="top">&nbsp;</td>				<td width="51%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">kfratio</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="21%" valign="top"><font face="Courier" size="2">1, 1, ikoct</font></td>				<td width="51%" valign="top"><font face="Courier" size="2">;mod.wheel controls tranposition</font></td>			</tr>			<tr>				<td width="13%" valign="top">&nbsp;</td>				<td width="16%" valign="top">&nbsp;</td>				<td width="21%" valign="top">&nbsp;</td>				<td width="51%" valign="top"><font face="Courier" size="2">;range: no transp. Up 2 octaves</font></td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="21%" valign="top"><font face="Courier" size="2">iamp, ifreq,1</font></td>				<td width="51%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">a2</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="21%" valign="top"><font face="Courier" size="2">iamp, ifreq*kfratio, 1 </font></td>				<td width="51%" valign="top"><font face="Courier" size="2">;2<sup>nd</sup> oscil is transposed by kfratio</font></td>			</tr>			<tr>				<td width="13%" valign="top">&nbsp;</td>				<td width="16%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="21%" valign="top"><font face="Courier" size="2">a1+a2</font></td>				<td width="51%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top">&nbsp;</td>				<td width="16%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="21%" valign="top">&nbsp;</td>				<td width="51%" valign="top">&nbsp;</td>			</tr>		</table>		<table cellspacing="0" border="0" width="464">			<tr>				<td width="7%" valign="top"><font face="Courier" size="2">f1</font></td>				<td width="10%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">128</font></td>				<td width="7%" valign="top"><font face="Courier" size="2">10</font></td>				<td width="3%" valign="top"><font face="Courier" size="2">1</font></td>				<td width="66%" valign="top"><font face="Courier" size="2">;sine table</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier" size="2">f0</font></td>				<td width="10%" valign="top"><font face="Courier" size="2">3600</font></td>				<td width="8%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="3%" valign="top">&nbsp;</td>				<td width="66%" valign="top"><font face="Courier" size="2">;allows 1 hour of real time playing</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier" size="2">e</font></td>				<td width="10%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="3%" valign="top">&nbsp;</td>				<td width="66%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.2</b> Orchestra and score code for <i>instr 401</i> featuring the midic7 scalable controller opcode.</p>		<p>As you can see in instrument 401, a <b>midic7</b> opcode is used to allow transposing the second oscillator up to two octaves high (factor 4). Line 2 of instrument 401's score contains an <i>f0</i> statement. This statement is used to create an action time with no associated action. This prevent Csound session to terminate before 3600 seconds are elapsed, allowing 1 hour of real time performance. MIDI real time oriented instruments are activated by using note-on messages. So no<i><b> </b></i><b>i</b> statements are necessary in the score. I remember you that Csound instruments containing MIDI control-change opcodes can be activated only by note-on messages. Any attempt to activate them via <b>i</b> statement in the score, will produce a crash of the program.</p>		<p>The following orc shows the use of<i><b> </b></i><b>midic14</b> opcode.</p>		<h2>Simple use of <b>midic14</b> to control <b>oscili</b> Frequency (No Table Indexing)</h2>		<p><img src="Image2.gif" width="526" height="485" align="LEFT" hspace="9"></p>		<p>&nbsp;</p>		<p>&nbsp;<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<b>Figure 4.3</b> Block diagram of <i>instr 402</i>, an addition synthesis instrument with 14-bit midi controler modulation of pitch.</p>		<p>		<table cellspacing="0" border="0" width="500">			<tr>				<td width="11%" valign="top">&nbsp;</td>				<td width="13%" valign="top"><font face="Courier" size="2">instr</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">402</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">cpsmidi</font></td>				<td width="32%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">iamp</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">ampmidi</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">1000</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">ikoct</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">16</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;4 octaves transposition factor</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">ioneup3</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">1/3</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">itwoup3</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">2/3</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">kfratio</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">midic14</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">1, 2, 1/ikoct-1, ikoct-1</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;modulation-wheel controls msb </font></td>			</tr>			<tr>				<td width="11%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="32%" valign="top">&nbsp;</td>				<td width="43%" valign="top"><font face="Courier" size="2">;and breath-control controls lsb </font></td>			</tr>			<tr>				<td width="11%" valign="top">&nbsp;</td>				<td width="13%" valign="top">&nbsp;</td>				<td width="32%" valign="top">&nbsp;</td>				<td width="43%" valign="top"><font face="Courier" size="2">;tranposition range: -4 up to </font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">ifreq1</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;+4 octaves base freq</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">kfreq2</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">ifreq*(1+kfratio*ioneup3) </font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;freq transposed 1/3 of kfratio</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">kfreq3</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">ifreq*(1+kfratio*itwoup3) </font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;freq transposed 2/3 of kfratio</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">kfreq4</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">ifreq*(1+kfratio)</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;freq transposed 3/3 of kfratio</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">iamp, ifreq1, 1</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;1<sup>st</sup> oscil with base freq</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">a2</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">iamp, kfreq2, 1</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;2<sup>nd</sup> is transposed 1/3 of kfratio</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">a3</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">iamp, kfreq3, 1 </font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;3<sup>rd</sup> is transposed 2/3 of kfratio</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier" size="2">a4</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">iamp, kfreq4, 1</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;4<sup>th</sup> is transposed by kfratio </font></td>			</tr>			<tr>				<td width="11%" valign="top">&nbsp;</td>				<td width="13%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="32%" valign="top"><font face="Courier" size="2">a1+a2+a3+a4</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="11%" valign="top">&nbsp;</td>				<td width="13%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="32%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.4 </b>Orchestra code of <i>instr 402</i> featuring the midic14 opcode used to route control data from controllers 1 and 4.</p>		<p>The score for instrument 2 is identical to the one for instrument 1, so refer to it.</p>		<p>This instrument outputs the sum of four oscillators. The first oscillator has a fixed frequency (<i>ifreq1</i>) determined by the MIDI note-number (<b>cpsmidi</b> opcode). The last oscillator frequency (<i>kfreq4</i>) is obtained by a transposition factor (<i>kfratio</i>) controlled by a <b>midic14</b> opcode. The most significant byte controller parameter is assigned to MIDI controller #1 (mod-wheel), while the less significant one is assigned to controller #2 (breath-control). Now the range is quite larger than in the previous orc: 8 octaves (from -4 to 4 octaves i.e. from 1/16 to 16). So, to obtain more precision, I used a <b>midic14</b> rather than a <b>midic7</b> opcode. The other two oscillator frequencies are scaled to respectively 1/3 and 2/3 of factor <i>kfreqratio</i>. A curious characteristic of this instrument is that frequcncy intervals among oscillators are always rational (i.e. always harmonic). If you run this instrument you will note that with transposition factors above 1, slider control behaves quite well, while, when using fractional transposition factors (from 1/16 up to 1), a little movement will produce a frequency shift too big to control with precision. To fix this problem, I will give you a new instrument almost identical to the previous one.</p>		<h2>Simple Use of <b>midic14</b> Controlling <b>oscili</b> Frequency With Table Indexing for Best Covering of Slider-Center Range</h2>		<h2>		<table cellspacing="0" border="0" width="468">			<tr>				<td width="13%" valign="top">&nbsp;</td>				<td width="15%" valign="top"><font face="Courier" size="2">instr</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">403</font></td>				<td width="36%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">cpsmidi</font></td>				<td width="36%" valign="top">&nbsp;</td>				<td width="36%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">iamp</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">ampmidi</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">1000</font></td>				<td width="36%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">ikoct</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">16</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">;4 octaves transposition factor</font></td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">ioneup3</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">1/3</font></td>				<td width="36%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="13%" valign="top"><font face="Courier" size="2">itwoup3</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">2/3</font></td>				<td width="36%" valign="top">&nbsp;</td>			</tr>		</table>		<table cellspacing="0" border="0" width="504">			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kfratio</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">midic14</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">1, 2, 1/ikoct-1, ikoct-1, 2</font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;mod.wheel controls msb and </font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="12%" valign="top">&nbsp;</td>				<td width="35%" valign="top">&nbsp;</td>				<td width="41%" valign="top"><font face="Courier" size="2">;breath con. controls lsb </font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="12%" valign="top">&nbsp;</td>				<td width="35%" valign="top">&nbsp;</td>				<td width="41%" valign="top"><font face="Courier" size="2">;tranposition range: -4 up to</font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="12%" valign="top">&nbsp;</td>				<td width="35%" valign="top">&nbsp;</td>				<td width="41%" valign="top"><font face="Courier" size="2">;+4 octaves table n.2 indexing</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">ifreq1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;base freq</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kfreq2</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">ifreq*(1+kfratio*ioneup3) </font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;freq transposed 1/3 of kfratio</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kfreq3</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">ifreq*(1+kfratio*itwoup3) </font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;freq transposed 2/3 of kfratio</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kfreq4</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">ifreq*(1+kfratio) </font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;freq transposed 3/3 of kfratio</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">iamp,ifreq1,1</font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;1st oscil with base freq</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">a2</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">iamp,kfreq2,1</font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;2nd is transposed 1/3 of kfratio</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">a3</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">iamp,kfreq3,1 </font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;3rd is transposed 2/3 of kfratio</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">a4</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">iamp,kfreq4,1</font></td>				<td width="41%" valign="top"><font face="Courier" size="2">;4th is transposed by kfratio </font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="12%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">a1+a2+a3+a4</font></td>				<td width="41%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="12%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="35%" valign="top">&nbsp;</td>				<td width="41%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<br>		<b>Figure 4.5</b> Orchestra code of <i>instr 403</i> which maps controller data through a table.</h2>		<p>The only difference between instrument 402 and instrument<b> </b>403 is that <b>midic14</b> now uses table indexing (with interpolation). The optional parameter ifn is now filled with number 2 to make reference to function table num 2. Here is the sco we see the simple use of <b>midic14</b> controlling <b>oscili</b> frequency use table indexing for best covering of slider-center range,</p>		<p>		<table cellspacing="0" border="0" width="356">			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">f1</font></td>				<td width="7%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">512</font></td>				<td width="13%" valign="top"><font face="Courier" size="2">10</font></td>				<td width="28%" valign="top"><font face="Courier" size="2">1</font></td>				<td width="33%" valign="top"><font face="Courier" size="2">;sine table</font></td>			</tr>		</table>		</p>		<p>and a table indexed by <b>midic14</b> from 1/16 to 1 to 16.</p>		<p>		<table cellspacing="0" border="0" width="482">			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f2</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="7%" valign="top"><font face="Courier" size="2">513</font></td>				<td width="4%" valign="top"><font face="Courier" size="2">7</font></td>				<td valign="top" colspan="3"><font face="Courier" size="2">0.0625 256 1 256 16</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f0</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">3600</font></td>				<td width="7%" valign="top">&nbsp;</td>				<td valign="top" colspan="3">&nbsp;</td>				<td width="50%" valign="top"><font face="Courier" size="2">;allows 1 hour of real time playing</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">e</font></td>				<td width="8%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td valign="top" colspan="2">&nbsp;</td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>		</table>		</p>		<p>As you can see, a half of the table space is filled with continuous values from 1/16 up to 1, while the other half is filled with values starting from 1 up to 16. This eliminates the problem arisen in instrument 402</p>		<p>Now I give you an intrument that uses <b>imidic7</b> at <b>i</b>-rate (orc 4). This instrument is a combination of four different instruments. One of the four instruments can be choosen at init-time through the current value of <b>ijump</b>, a <b>i</b>-rate variable modified by <b>imidic7</b> opcode, which operates as a switch for enabling one of the four instruments.</p>		<h2>&quot;Four in One&quot; Example: Using <b>midic7</b> as a Switch for Several Instruments</h2>		<p>		<table cellspacing="0" border="0" width="491">			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="16%" valign="top"><font face="Courier" size="2">instr 404</font></td>				<td width="15%" valign="top">&nbsp;</td>				<td width="61%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">inum</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="15%" valign="top">&nbsp;</td>				<td width="61%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">icps</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">cpsmidi</font></td>				<td width="15%" valign="top">&nbsp;</td>				<td width="61%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">iamp</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">ampmidi</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">4000</font></td>				<td width="61%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="16%" valign="top">&nbsp;</td>				<td width="15%" valign="top">&nbsp;</td>				<td width="61%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">ijump</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">imidic7</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">1, 0, 4</font></td>				<td width="61%" valign="top"><font face="Courier" size="2">;switch four Instruments at init time (range 0-4)</font></td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="16%" valign="top">&nbsp;</td>				<td width="15%" valign="top">&nbsp;</td>				<td width="61%" valign="top"><font face="Courier" size="2">;1=instr1, 2=instr2, 3=instr3, 4=instr4</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">kctr1</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">2, 0, 1</font></td>				<td width="61%" valign="top"><font face="Courier" size="2">;scales different instr. parameters (range 0-1)</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">kctr2</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">midic7 </font></td>				<td width="15%" valign="top"><font face="Courier" size="2">4, 0, 1</font></td>				<td width="61%" valign="top"><font face="Courier" size="2">;scales different instr. parameters (range 0-1)</font></td>			</tr>		</table>		</p>		<p>		<table cellspacing="0" border="0" width="491">			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="17%" valign="top">&nbsp;</td>				<td width="36%" valign="top">&nbsp;</td>				<td width="39%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="17%" valign="top">&nbsp;</td>				<td width="36%" valign="top">&nbsp;</td>				<td width="39%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="17%" valign="top"><font face="Courier" size="2">if ijump&gt;1 </font></td>				<td width="36%" valign="top"><font face="Courier" size="2">goto two</font></td>				<td width="39%" valign="top"><font face="Courier" size="2">;imidic7 dependent jump</font></td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="17%" valign="top">&nbsp;</td>				<td width="36%" valign="top">&nbsp;</td>				<td width="39%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><b>Simple oscillator plus amplitude envelope</b></p>		<p>		<table cellspacing="0" border="0" width="491">			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">kmp</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">linenr</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">iamp, .01, 1, .03</font></td>				<td width="40%" valign="top"><font face="Courier" size="2">;ampenv</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">kmp, icps, 2</font></td>				<td width="40%" valign="top"><font face="Courier" size="2">;audio oscillator</font></td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="16%" valign="top"><font face="Courier" size="2">goto</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="40%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">;</font></td>				<td width="16%" valign="top">&nbsp;</td>				<td width="36%" valign="top">&nbsp;</td>				<td width="40%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">two:</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">if ijump&gt;2</font></td>				<td width="36%" valign="top"><font face="Courier" size="2">goto three</font></td>				<td width="40%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><b>FM synthesis</b></p>		<p>		<table cellspacing="0" border="0" width="500">			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">kmp</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">linenr</font></td>				<td width="55%" valign="top"><font face="Courier" size="2">iamp, .04, .2, .03</font></td>				<td width="20%" valign="top"><font face="Courier" size="2">;ampenv</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">kndx</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="55%" valign="top"><font face="Courier" size="2">0, 30, .6, 10</font></td>				<td width="20%" valign="top"><font face="Courier" size="2">;mod index control</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">foscili</font></td>				<td width="55%" valign="top"><font face="Courier" size="2">kmp, icps*.25, 2, kctr1*4, kndx*kctr2, 1</font></td>				<td width="20%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="15%" valign="top"><font face="Courier" size="2">goto</font></td>				<td width="55%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="20%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">;</font></td>				<td width="15%" valign="top">&nbsp;</td>				<td width="55%" valign="top">&nbsp;</td>				<td width="20%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">three:</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">if ijump&gt;3</font></td>				<td width="55%" valign="top"><font face="Courier" size="2">goto four</font></td>				<td width="20%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><b>Ring modulation and clipping synthesis</b></p>		<p>		<table cellspacing="0" border="0" width="491">			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">kmp</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">linenr</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">iamp, .04, .2,. 03 </font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;ampenv</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">kamp2</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">iamp*.5, .25, 11</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;clipping control</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">am1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili </font></td>				<td width="43%" valign="top"><font face="Courier" size="2">kmp*.01, icps, 1</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;carrier</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">am2</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">oscili </font></td>				<td width="43%" valign="top"><font face="Courier" size="2">kmp*kctr1*.1, icps*kctr2*2+.5, 1</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;modulator</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">am1*am2</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;ring modulation</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">limit </font></td>				<td width="43%" valign="top"><font face="Courier" size="2">a1, -kamp2, kamp2</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;clip modulation</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">a1*iamp/kamp2</font></td>				<td width="35%" valign="top"><font face="Courier" size="2">;amplitude rescaling</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="12%" valign="top"><font face="Courier" size="2">goto</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="35%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">;</font></td>				<td width="12%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>				<td width="35%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">four:</font></td>				<td width="12%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>				<td width="35%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><b>Karplus-Strong synthesis</b></p>		<p>		<table cellspacing="0" border="0" width="491">			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">kmp</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">linenr</font></td>				<td width="38%" valign="top"><font face="Courier" size="2">iamp*5, 0, .2, .03 </font></td>				<td width="42%" valign="top"><font face="Courier" size="2">;ampenv</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">pluck</font></td>				<td width="38%" valign="top"><font face="Courier" size="2">kmp, icps, 10000, 5, 1</font></td>				<td width="42%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">out:</font></td>				<td width="12%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="38%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="42%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="12%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="38%" valign="top">&nbsp;</td>				<td width="42%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<br>		<b>Figure 4.6</b> Orchestra code for <i>instr 404</i>, a design which uses the mod-wheel to switch between 1 of 4 different synthesizer methods.</p>		<p>The next .orc and .sco files show the way for implementing a score-oriented orchestra, whose tempo can be modified in real time by means of MIDI.</p>		<h2>MIDI Controller 1 Changes Score Tempo in Real-Time</h2>		<p><i>WARNING!</i> Set <i>-t</i> flag when testing this .orc! play a MIDI note to activate instr 401 if you want change score tempo.</p>		<p><img src="Image3.gif" width="136" height="153" align="LEFT" hspace="9"></p>		<p>&nbsp;</p>		<p>&nbsp;<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		</p>		<p><b><br>		Figure 4.7</b> Block diagram of <i>instr 405</i> which uses a midi controller to control the tempo of a score file.</p>		<h2>Tempo Controller Instrument</h2>		<p>		<table cellspacing="0" border="0" width="351">			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">instr </font></td>				<td width="63%" valign="top"><font face="Courier" size="2">405</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">k1</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">midic7 </font></td>				<td width="63%" valign="top"><font face="Courier" size="2">1, 30, 500</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">tempo</font></td>				<td width="63%" valign="top"><font face="Courier" size="2">k1, 60</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="63%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="27%" valign="top">&nbsp;</td>				<td width="63%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.8</b> Orchestra of <i>instr 405</i> illustrating the use of the tempo opcode under the variable control of the modulation wheel controller 1.</p>		<p>&nbsp;</p>		<h2><b>Simple Random Pitch Instrument</b></h2>		<p><img src="Image4.gif" width="124" height="245" align="LEFT" hspace="9"></p>		<p>&nbsp;<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<b>Figure 4.9</b> Block diagram of <i>instr406</i> a random pitch instrument.&nbsp;</p>		<p>		<table cellspacing="0" border="0" width="365">			<tr>				<td width="22%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">instr </font></td>				<td width="59%" valign="top"><font face="Courier" size="2">406</font></td>			</tr>			<tr>				<td width="22%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">ilinrand </font></td>				<td width="59%" valign="top"><font face="Courier" size="2">1500</font></td>			</tr>			<tr>				<td width="22%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="59%" valign="top"><font face="Courier" size="2">p4, ifreq+550, 1</font></td>			</tr>			<tr>				<td width="22%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="59%" valign="top"><font face="Courier" size="2">a1</font></td>			</tr>			<tr>				<td width="22%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="59%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.10</b> Orchestra and score code of <i>instr 406</i>, and the score whole tempo is controlled in realtime via the modulation wheel.</p>		<h2><b>MIDI controller 1 Changes Score Tempo in Real-Time</b></h2>		<p>WARNING! Set <i>-t</i> flag when testing this .sco! Play a MIDI note to activate instr 405 if you want change score tempo instr 405 must be allocated only via MIDI, otherwise Csound will crash!</p>		<p>		<table cellspacing="0" border="0" width="329">			<tr>				<td width="7%" valign="top"><font face="Courier" size="2">f1</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="10%" valign="top"><font face="Courier" size="2">512</font></td>				<td width="7%" valign="top"><font face="Courier" size="2">10</font></td>				<td width="22%" valign="top"><font face="Courier" size="2">1 1 1 </font></td>				<td width="46%" valign="top"><font face="Courier" size="2">;audio wavetable</font></td>			</tr>		</table>		&nbsp;</p>		<p>		<table cellspacing="0" border="0" width="383">			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i6</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.2</font></td>				<td valign="top" colspan="2"><font face="Courier" size="2">2000 </font></td>				<td width="63%" valign="top"><font face="Courier" size="2">;simple random-pitched Instrument</font></td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">i.</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">+</font></td>				<td width="6%" valign="top"><font face="Courier" size="2">.</font></td>				<td width="8%" valign="top"><font face="Courier" size="2">.</font></td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier" size="2">e</font></td>				<td width="6%" valign="top">&nbsp;</td>				<td width="6%" valign="top">&nbsp;</td>				<td width="8%" valign="top">&nbsp;</td>				<td valign="top" colspan="2">&nbsp;</td>			</tr>		</table>		</p>		<p>This instrument produces a stream of random-pitched notes. The speed of this note-flow can be varied by means of MIDI control #1 (mod-wheel). Note that two instruments are necessary for doing this, because a score-oriented Instrument cannot contain MIDI IN controller opcodes. So instrument 405, which contains a call to <b>midic7</b> opcode, must be activated by a MIDI note-on message, while instrument 406 is activated by the <b>i<i> </i></b>statements in sco file. If you want to play this example remember to set <i><b>-t</b></i> command line switch for enabling tempo-changes within instruments. In general, it is always possible to modify score-oriented instrument parameters by means of an additional MIDI-triggered instrument modifying global variables. In fact, the score-oriented instrument can access these global variables with no problems.</p>		<p>Last instrument uses <b>xtratim</b> and <b>release<i> </i></b>opcodes. These opcodes are very useful to extend a midi-activated note duration and for implementing complex release-oriented envelopes.</p>		<p>The syntax of these opcodes is:</p>		<p><b>xtratim<i> </i></b><i>iextradur</i> <i>kflag<b> </b>release</i></p>		<p>where <i>iextradur</i> is the extra duration added to the end of a note to allow release, and <i>kflag</i> is an output flag that informs whether current note is in the release-stage or it is not.</p>		<p>This is the orchestra:</p>		<h2><b>Using xtratim and release to Implement Complex ADSR Envelopes</b></h2>		<p><img src="Image5.gif" width="543" height="396" align="LEFT" hspace="9"></p>		<p>&nbsp;</p>		<p>&nbsp;<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		</p>		<p><b><br>		Figure 4.11</b> Block diagram of <i>instr 406 </i>a midi instrument featuring the xtratim and release opcodes.</p>		<p>		<table cellspacing="0" border="0" width="347">			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="23%" valign="top"><font face="Courier" size="2">instr </font></td>				<td width="65%" valign="top">&nbsp;406</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">inum</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">icps</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">cpsmidi</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">iamp</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">ampmidi</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">4000</font></td>			</tr>		</table>		</p>		<p><b>Complex MIDI Envelope</b></p>		<p>		<table cellspacing="0" border="0" width="531">			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">xtratim</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">1</font></td>				<td width="59%" valign="top"><font face="Courier" size="2">;extra-time, i.e. release duration</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">krel</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">init</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="59%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">krel</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">release</font></td>				<td width="16%" valign="top">&nbsp;</td>				<td width="59%" valign="top"><font face="Courier" size="2">;outputs release-stage flag (0 or 1 values)</font></td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">if (krel&gt;.5)</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">kgoto rel</font></td>				<td width="59%" valign="top"><font face="Courier" size="2">;if in relase-stage goto relase section</font></td>			</tr>		</table>		</p>		<p><b>Attack-Sustain Section</b></p>		<p>		<table cellspacing="0" border="0" width="491">			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">kmp1</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">linseg</font></td>				<td width="75%" valign="top"><font face="Courier" size="2">0, .03, 1, .05, 1, .07, 0, .08, .5, 4, 1, 50, 1</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier" size="2">kmp</font></td>				<td width="16%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="75%" valign="top"><font face="Courier" size="2">kmp1*iamp</font></td>			</tr>			<tr>				<td width="8%" valign="top">&nbsp;</td>				<td width="16%" valign="top"><font face="Courier" size="2">kgoto</font></td>				<td width="75%" valign="top"><font face="Courier" size="2">done</font></td>			</tr>		</table>		</p>		<p><b>Release Section</b></p>		<p>		<table cellspacing="0" border="0" width="347">			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">rel:</font></td>				<td width="23%" valign="top">&nbsp;</td>				<td width="65%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kmp2</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">linseg</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">1, .3, .2, .7, 0</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kmp</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">kmp1*kmp2*iamp</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">done:</font></td>				<td width="23%" valign="top">&nbsp;</td>				<td width="65%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><b>End of Envelope Routine</b></p>		<p>		<table cellspacing="0" border="0" width="347">			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">a1</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">oscili</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">kmp,icps,1</font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="23%" valign="top"><font face="Courier" size="2">out</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">a1</font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="23%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.12</b> Ochrestra and score code of <i>instr 406</i>, A midi instrument with a complex ADSR envelope implemented via xtratim and release opcodes.</p>		<p>In instrument 406 <b>xtratim</b> extends note duration 1 second more, and <b>release</b> tell us when current note will be in the release stage, returning a 1 (in normal stage it returns 0). An <b>if ... kgoto</b> statement chooses one of the two envelopes according to <b>release</b> opcode output. Note that, in the release-stage, last value returned by the previous envelope is used to scale the new envelope output. This thing is necessary to prevent a discontinuity during the transition from the first to the second envelope. Here the two envelopes are implemented by using <b>linseg</b> opcode, but any envelope-oriented opcode could be used (such as <b>oscil1</b>, <b>oscil1i</b>, <b>line</b>, <b>expseg</b> etc.). Also any number of envelopes can be inserted in both the attack-sustain and release sections, to control in different ways various parameters of an instrument in parallel.&nbsp;</p>		<h2><b>MIDI Out: A New Field of Interest is Opening in Csound</b>&nbsp;</h2>		<p>Until now, Csound was sound synthesis language allowing audio-rate output only to files or directly to DAC. With the 1992 MIT version, MIDI IN capabilities were introduced for controlling real time performances, but its output was ever a stream of audio-samples. Now, with the new MIDI OUT opcodes it is possible to use Csound as a real time-MIDI-event generator too. All old <b>i</b> and <b>k</b>-rate opcodes of Csound can be used as input of the new MIDI OUT opcodes now, making Csound a very powerful tool for MIDI processing.</p>		<p>Some examples of utilization of the new opcodes could be:</p>		<dir>			<p>&#149;Producing complex algorythmically-generated streams of MIDI events, allowing new concepts of composing and interacting with MIDI instruments.</p>			<p>&#149;Creation of powerful fully-customized MIDI effect processors such as MIDI delays, MIDI arpeggiators, MIDI message remappers etc.</p>			<p>&#149;Changing external MIDI instrument parameters in real-time during a performance.</p>			<p>&#149;Precise timed controlling of recording-studio devices as MIDI mixers, MIDI controlled DATs and ADATs etc.</p>			<p>&#149;Generating MIDI commands to MIDI-CV interfaces to drive analog synthesizers.</p>			<p>&#149;Controlling non-musical equipment like lights, images etc.</p>		</dir>		<p>All MIDI OUT opcodes don&#146;t have any output argument because their output is directly sent to current MIDI OUT port. Differently from some MIDI IN opcodes, it is perfectly possible to use MIDI OUT opcodes in score-oriented instruments. So an<i><b> </b></i><b>i</b> statement in a score can activate an instruments containing any number and any kind of MIDI OUT opcodes.</p>		<p>For a detaliled description of the syntax of each opcode, read the appendix of this chapter titled &quot;<b>New MIDI opcodes syntax&quot;</b>.</p>		<p>&nbsp;</p>		<h1><b>MIDI Out-Based Instruments</b>&nbsp;</h1>		<p>In this section I give you some .orc and .sco example of the new MIDI OUT opcodes. The first example (instrument 407) is the use of <b>ion</b> and <b>ioff</b> opcodes to output single-key-triggered chords.</p>		<h2><b>Chords Generated by Single Key</b></h2>		<p><img src="Image6.gif" width="516" height="410" align="LEFT" hspace="9"></p>		<p>&nbsp;<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<b>Figure 4.13</b> Block diagram of <i>instr 407</i> an instrument which &quot;generates&quot; midi events.&nbsp;</p>		<p>		<table cellspacing="0" border="0" width="365">			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">instr 407</font></td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">k1</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">init</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0</font></td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">ifund</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">ifth</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">ifund+7</font></td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">ioct</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">ifund+12</font></td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">ivel</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">veloc</font></td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">ion</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0, ifund, ivel</font></td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">ion</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0, ifth, ivel</font></td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">ion</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0, ioct, ivel</font></td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">k1</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">release</font></td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">if (k1&gt;.5) </font></td>				<td width="52%" valign="top"><font face="Courier" size="2">kgoto noteoff</font></td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">goto end</font></td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">noteoff:</font></td>				<td width="27%" valign="top">&nbsp;</td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">reinit</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">off</font></td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">off:</font></td>				<td width="27%" valign="top">&nbsp;</td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">ioff</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0, ifund, ivel</font></td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">ioff</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0, ifth, ivel</font></td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">ioff</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">0, ioct, ivel</font></td>			</tr>			<tr>				<td width="21%" valign="top"><font face="Courier" size="2">end:</font></td>				<td width="27%" valign="top">&nbsp;</td>				<td width="52%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="21%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="52%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.14</b> Orchestra code of <i>instr 407</i> which generates midi messages to play a chord on an external midi synthesizer from Csound.</p>		<p>The three instances of <b>ion</b> activate the notes of the chord. The new <b>release</b> opcode is used to detect if current instrument instance is terminating. If yes, a <b>reinit</b> statement is executed to use <b>ioff</b> opcode in a moment other than the initial instrument instance creation.</p>		<p>The same behaviour of instrument 407, but with a simpler code, can be achieved by using <b>iondur</b> opcode as you can see in instrument 408:</p>		<h2><b>Chords Generated by Single Key: Second Version</b></h2>		<p><img src="Image7.gif" width="386" height="222" align="LEFT" hspace="9"></p>		<p>&nbsp;<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<br>		<b>Figure 4.15</b> Block diagram of <i>instr 408</i> which generates external midi events of a finite duration as specified by the iondur opcode.</p>		<p>		<table cellspacing="0" border="0" width="365">			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="25%" valign="top"><font face="Courier" size="2">instr 408</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">k1</font></td>				<td width="25%" valign="top"><font face="Courier" size="2">init</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">0</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">ifund</font></td>				<td width="25%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">ifth</font></td>				<td width="25%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">ifund+7</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">ioct</font></td>				<td width="25%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">ifund+12</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">ivel</font></td>				<td width="25%" valign="top"><font face="Courier" size="2">veloc</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="25%" valign="top"><font face="Courier" size="2">iondur</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">0, ifund, ivel, 1000</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="25%" valign="top"><font face="Courier" size="2">iondur</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">0, ifth, ivel, 1000</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="25%" valign="top"><font face="Courier" size="2">iondur</font></td>				<td width="65%" valign="top"><font face="Courier" size="2">0, ioct, ivel, 1000</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td width="25%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="65%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<br>		<b>Figure 4.16</b> Orchestra code of <i>instr 408</i>, A midi instrument which plays a chord on an external midi synthesizer in a response to a single note on on message.</p>		<p><b>iondur</b> opcode has the <i>idur</i> additional argument, sending a note-off message after <i>idur</i> seconds. The note-off message is sent automatically at the deactivating-moment of the correspondent instrument instance (probably before than 1000 seconds) by giving an exaggerated value to this parameter (such as 1000).</p>		<p>Next instrument shows a <b>koutc</b> opcode example:</p>		<h2><b>MIDI-Generated Tremolo</b></h2>		<p><img src="Image8.gif" width="448" height="282"><br>		<br>		<b>Figure 4.17</b> Block diagram of <i>instr 409</i>, A midi instrument which generates external</p>		<h2><b>Controller Messages</b></h2>		<p>		<table cellspacing="0" border="0" width="455">			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="19%" valign="top"><font face="Courier" size="2">instr 409</font></td>				<td width="22%" valign="top">&nbsp;</td>				<td width="47%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">i1</font></td>				<td width="19%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="22%" valign="top">&nbsp;</td>				<td width="47%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">i3</font></td>				<td width="19%" valign="top"><font face="Courier" size="2">veloc</font></td>				<td width="22%" valign="top">&nbsp;</td>				<td width="47%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kfreq</font></td>				<td width="19%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="22%" valign="top"><font face="Courier" size="2">1, 1, 20</font></td>				<td width="47%" valign="top"><font face="Courier" size="2">;mod.wheel controls tremolo speed</font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">kamp</font></td>				<td width="19%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="22%" valign="top"><font face="Courier" size="2">2, 0, 1</font></td>				<td width="47%" valign="top"><font face="Courier" size="2">;breath-ctrl controls tremolo depth </font></td>			</tr>			<tr>				<td width="12%" valign="top"><font face="Courier" size="2">k1</font></td>				<td width="19%" valign="top"><font face="Courier" size="2">oscil</font></td>				<td width="22%" valign="top"><font face="Courier" size="2">kamp, kfreq, 1</font></td>				<td width="47%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="19%" valign="top"><font face="Courier" size="2">koutc</font></td>				<td width="22%" valign="top"><font face="Courier" size="2">0, 7, 1-k1, 0, 1</font></td>				<td width="47%" valign="top"><font face="Courier" size="2">;changes vol. of midi-chn 0</font></td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="19%" valign="top"><font face="Courier" size="2">iondur</font></td>				<td width="22%" valign="top"><font face="Courier" size="2">0, I1, I3, 1000</font></td>				<td width="47%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="12%" valign="top">&nbsp;</td>				<td width="19%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="22%" valign="top">&nbsp;</td>				<td width="47%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.18</b> Orchestra code for <i>instr 409</i>, a midi instrument which responds to 2 midi controllers and maps them to generate a different external controller message.</p>		<p>In this orc <b>iondur</b> plays a note and <i>koutc</i> modulates the main volume (midi-controller #7) of midi-channel 0, so a tremolo effect is produced. Frequency of tremolo can be varied in frequency via controller #1 (mod.wheel) messages, and in depth via controller #2 (breath-control) messages.</p>		<p>Next intrument (<b>orc 10</b>) is a simple utilization of <b>moscil</b> opcode. <b>moscil</b> is, together with <b>kon</b> and <b>mseq</b>, the most complex MIDI OUT opcode.</p>		<h2><b>Simple moscil Opcode Example</b></h2>		<p><img src="Image9.gif" width="396" height="326"><br>		<br>		<b>Figure 4.19</b> Block diagram of <i>instr 410</i>, a midi instrument which generates a stream of external midi note message.</p>		<p>		<table cellspacing="0" border="0" width="342">			<tr>				<td width="15%" valign="top">&nbsp;</td>				<td width="23%" valign="top"><font face="Courier" size="2">instr 410</font></td>				<td width="62%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier" size="2">i1</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="62%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier" size="2">i3</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">veloc</font></td>				<td width="62%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier" size="2">kfreq</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="62%" valign="top"><font face="Courier" size="2">1, .02, 3</font></td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier" size="2">kdur</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="62%" valign="top"><font face="Courier" size="2">2, .5, .02</font></td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier" size="2">kpitch</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="62%" valign="top"><font face="Courier" size="2">3, 0, 24</font></td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier" size="2">k1</font></td>				<td width="23%" valign="top"><font face="Courier" size="2">oscil</font></td>				<td width="62%" valign="top"><font face="Courier" size="2">kpitch, kfreq, 1</font></td>			</tr>			<tr>				<td width="15%" valign="top">&nbsp;</td>				<td width="23%" valign="top"><font face="Courier" size="2">moscil</font></td>				<td width="62%" valign="top"><font face="Courier" size="2">0, i1+k1, I3, kdur, kdur</font></td>			</tr>			<tr>				<td width="15%" valign="top">&nbsp;</td>				<td width="23%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="62%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.20</b> Orchestra score for <i>instr 410</i>, a midi instrument which generates multiple midi note messages via the moscil opcode.</p>		<p><b>moscil</b> outputs a stream of MIDI notes of <i>kdur</i> duration, each followed by a pause of <i>kpause</i> duration. Duration, pause, pitch and velocity of each note can be varied at <b>k</b>-rate. In this case the pitch of notes is varied by means of an <b>oscil</b> opcode. The frequency of <b>oscil</b> is controlled by MIDI controller #1, while its pitch-range is controlled by MIDI controller #3. Duration and pause of each note are controlled by MIDI controller #2. The time range of note-repeat cycle is from 1/25 of second (0.02x2 secs) to 1 second (0.5x2 secs).</p>		<p>Next example will use <b>kon</b> opcode (see instrument 412)</p>		<h2><b>kon Playing Diatonic Scale</b></h2>		<p><img src="Image10.gif" width="397" height="605"><b><br>		</b></p>		<p><b>Figure 4.21</b> Block diagram of <i>instr 411</i>, a midi instrument which repeatedly &quot;loops&quot; through a table and generates a sequencer of external midi note-on messages.</p>		<p>		<table cellspacing="0" border="0" width="455">			<tr>				<td width="9%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">instr 411</font></td>				<td width="30%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">i1</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">notnum</font></td>				<td width="30%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">i3</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">veloc</font></td>				<td width="30%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">kfreq</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">1, .02, 3</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">kpitch</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">2, 0, 14</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">ktempo</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">midic7</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">3, .2, 25</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">knum</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">oscil</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">kpitch, kfreq, 1</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">knum</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">knum-11</font></td>				<td width="43%" valign="top"><font face="Courier" size="2">;offset for C4 correspondence</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">koct</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">limit</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">knum+i1, 0, 96</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">koct</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">table</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">koct, 2</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">knote</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">wrap</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">knum+i1, 0, 7</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">knote</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">table</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">knote, 3</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">knum</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">=</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">koct+knote </font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">krythm</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">oscil</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">1, ktempo, 4</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">knum</font></td>				<td width="18%" valign="top"><font face="Courier" size="2">samphold</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">knum, krythm</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">kon</font></td>				<td width="30%" valign="top"><font face="Courier" size="2">0, knum, i3</font></td>				<td width="43%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top">&nbsp;</td>				<td width="18%" valign="top"><font face="Courier" size="2">endin</font></td>				<td width="30%" valign="top">&nbsp;</td>				<td width="43%" valign="top">&nbsp;</td>			</tr>		</table>		<table cellspacing="0" border="0" width="473">			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f1</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">0 512 10</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">1 1 1 1</font></td>				<td width="49%" valign="top"><font face="Courier" size="2">;melody shape</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f2</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">0 128 -17</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">0 -24 7 -12 14 0</font></td>				<td width="49%" valign="top"><font face="Courier" size="2">;octaves</font></td>			</tr>			<tr>				<td width="9%" valign="top">&nbsp;</td>				<td width="15%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">21 12 28 24 35 36</font></td>				<td width="49%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top">&nbsp;</td>				<td width="15%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">42 48 49 60 56 72</font></td>				<td width="49%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top">&nbsp;</td>				<td width="15%" valign="top">&nbsp;</td>				<td width="27%" valign="top"><font face="Courier" size="2">63 84 70 96 77 108</font></td>				<td width="49%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f3</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">0 16 -2</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">0 2 4 5 7 9 11</font></td>				<td width="49%" valign="top"><font face="Courier" size="2">;C major scale</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f4</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">0 16 -2</font></td>				<td width="27%" valign="top"><font face="Courier" size="2">1 0 0 0 0 0 0 0 1 0 0 0 1 0 0 0</font></td>				<td width="49%" valign="top"><font face="Courier" size="2">;rythm shape</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">f0</font></td>				<td width="15%" valign="top"><font face="Courier" size="2">50000</font></td>				<td width="27%" valign="top">&nbsp;</td>				<td width="49%" valign="top"><font face="Courier" size="2">;allows rt midi playing for 50000 seconds</font></td>			</tr>			<tr>				<td width="9%" valign="top"><font face="Courier" size="2">e</font></td>				<td width="15%" valign="top">&nbsp;</td>				<td width="27%" valign="top">&nbsp;</td>				<td width="49%" valign="top">&nbsp;</td>			</tr>		</table>		<br>		<b>Figure 4.22</b> Orchestra and score code of <i>instr 411</i>, a midi instrument which utilize the wrap and limit opcode to send a stream of external note-on messages.</p>		<p>The<b> kon</b> opcode is in certain ways similar to <b>moscil</b>. Both send a stream of note-on and note-off messages to MIDI OUT port. The difference is that <b>kon</b> does not have duration neither pause parameters. So new note on-off messages are generated when any of its parameter changes. So continuous curves used as parameter-controls may cause a very big on/off messages amount. Eventually, I suggest to use step functions generated by means of <b>GEN<i> </i>17</b> to square the output of other continuous control signals.</p>		<p>This protects from possible MIDI buffer overloading, and can give a more accurate control of the range of generated events. In this case <b>GEN 17</b> and <b>GEN 2 </b>are used to generate step function to index a diatonic scale: <i>f2</i> contains the octaves and <b>f3</b> contains the tone/half-tone structure.<i>f4</i> contains the rhythm skeleton. The value of pitch is processed by two oscillators: the first generate raw output (<i>knum</i>). The variable <i>knum</i> is used as index of table #2 (octaves) and table #3 (diatonic scale). The opcodes <b>limit</b> (by Robin Whittle) and <b>wrap</b> (by me) are very useful to limit and to wrap-around index-values that exceed a non-power-of-two number. <i>knum</i> is then sampled at <i>krythm</i>-tics rate and sent to <b>kon</b>.</p>		<h2><b>Conclusion&nbsp;</b></h2>		<p>In this chapter I introduced some of new MIDI IN, MIDI OUT, real-time-envelope-related and new useful opcodes, and I provided some simple .orc and .sco examples to learn using them.</p>		<p>With all these opcodes, the user can explore new ways of interacting with Csound. MIDI OUT is a new exciting and never seen feature of Csound. Control your favourite MIDI synth with Csound-generated algorythms! Run two instances of Csound in the same computer, the first outputting MIDI events only and the second generating audio signals in real time! The first instance could control an external synth toghether with a second Csound instance in parallel! You can build complex networks of internal and external MIDI-message flows. I invite all of you to experiment and to make wonderful live Csound-based concerts!	</body></html>