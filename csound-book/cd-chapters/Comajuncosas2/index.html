<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>Phisical models (mass-string paradigm)</title>		<meta name="Author" content="Josep M Comajuncosas">	</head>	<body bgcolor="white">		<h1>21. Physical Models of Strings and Plates Using a Simplified Mass-String Method</h1>		<h2>Josep M. Comajuncosas&nbsp;</h2>		<h3>Introduction</h3>		<p>The next set of orquestras are based on the documentation included in the freely available Demo-version of PhyMod V2.0., a nice program to design physical models simply by linking masses in a graphical environment. In fact I liked so much the simplicity of the approach that I decided to port some instruments to Csound. Thus, though the powerful graphycal interface is lost (and the ease to make complex structures without virtually any effort), you can use the designs directly to make music, and not only to generate sound samples. You can always make the design quickly with PhyMod, test it and, if you like the sound obtained, code it to Csound.<br>		The instruments included here should help you to do it.<br>		You should find PhyMod at <a href="http://141.84.217.141/phymod">http://141.84.217.141/phymod</a> , though I&acute;m afraid it is no longer available.<br>		You are warned, though. Don&acute;t expect the elegance and computational efficiency of Waveguide synthesis here. The models compile incredibly slowly, and the implementation is extremely crude.<br>		&nbsp;</p>		<h3>The Mass-Spring Paradigm</h3>		<p><i>The term physical modeling is applied liberally to all the hardware or software devoted to the simulation of mechanical events, however elegantly or inelegantly this is achieved.</i><br>		(From PhyMod manual)</p>		<p>Here the implementation is rather basic. Next is a summary of the <i>Principles</i> in the help file of PhyMod. Consider a mass m tied to a spring whose damping is z and whose restoring force is k.&nbsp; The sum of all forces must be zero, then we have</p>		<p><i>Force of inertia + Restoring force + Friction force = 0</i></p>		<p>-mx&acute;&acute;-kx - zx&acute; = 0 (x being the displacement)<br>		x&acute;&acute;+(k/m)x+(z/m)x&acute;= 0 being w=sqrt(k/m) = oscil. frequency<br>		then of course x&acute;&acute;= -F/m</p>		<p>To discretize the system, let&acute;s suppose sr&lt;&lt;w and then the following approximations are reasonable</p>		<p>x ~ x(n)<br>		x&acute;~ x(n)-x(n-1)<br>		x&acute;&acute;~ x(n)-2x(n-1)-x(n-2)</p>		<p>Then, for example, after some substitutions you get<br>		(for 2 masses m1 and m2 , tied with a string; force from mass 2 to mass 1)</p>		<p>F1(n) = k(x2-x1) +z(x2(n)-x2(n-1)-x1(n)-x1(n-1)) = -F2(n)</p>		<p>x1(n+1) = F1(n)/m1 + 2x(n-2) -x(n-1)</p>		<p>To sum up, you must calculate all the forces that act on masses, summate them and then use the forces to calculate<br>		the new positions x(n+1) for every mass. If you don&acute;t see clearly how the stuff works, please look at PhyMod help.<br>		&nbsp;</p>		<h3>Implementation</h3>		<p>In the simplest cases (dealing with 1 or 2 masses only) a direct implementation will be enough. For an arbitrary number of masses in a simple relationship (a string or a plate), I used the <i>zak system</i> to allocate all the variables needed (previous, actual and next positions of masses and actual forces, so you&acute;ll need 4*n variables, being n the number of masses in the system). However, for arbitrarily complex structures the necessarily direct implementation can lead to an incredibly messy code. Anyway, some designs are a good practice to get used to the new <i>zak</i> opcodes.<br>		&nbsp;</p>		<h3>Examples</h3>		<ul>			<li><a href="pm1.orc">pm1.orc</a> <a href="pm1.sco">pm1.sco</a>		</ul>		<center>			<p><img src="sinus.jpg"></p>		</center>		<p>&nbsp;A damped sine wave can be generated simply by linking a mass with some energy (initial position and/or velocity different from 0) to the ground. The ground is effectively considered as an infinite mass, and keeps the system from becoming unstable. You can choose the initial position to be 0 (but some initial velocity) to avoid that click at the beginning. The first 5 notes show the effect of varying the damping, the 5 next show how varying the restoring force k leads to different vibration frequencies. This could also be done with a different mass. In real string instruments a combination of different linear density (<i>mass</i>) and tension (<i>k</i>) is normally used, and fine tuning is done with slight adjustements of <i>k.</i></p>		<p>Notice also that this is a way to obtain extremely pure sine waves without table look-up. It is slower but much better, specially at low frequencies.<br>		&nbsp;</p>		<ul>			<li><a href="pm2.orc">pm2.orc</a> <a href="pm2.sco">pm2.sco</a>		</ul>		<p>&nbsp;The next example is very similar to the previous one, except that here we have 2 identical masses, one tied to the other and the second one grounded. The sound has now 2 main frequencies (it may be easy to predict them exactly).<br>		&nbsp;</p>		<ul>			<li><a href="pm3.orc">pm3.orc</a> <a href="pm3.sco">pm3.sco</a>		</ul>		<p>Two masses linked, and each one respectively grounded can be seen as an oversimplification of a real plucked string tied at both ends, like the real ones. Don&acute;t expect a plucked string sound, though. It is more similar to a hammered metallic bar (?)<br>		&nbsp;</p>		<ul>			<li><a href="pm4.orc">pm4.orc</a> <a href="pm4.sco">pm4.sco</a>		</ul>		<center>			<p><img src="string.jpg"></p>		</center>		<p>After hearing the previous instrument, I thought what would happen if the number of masses of the simulated string was enough large. Maybe the resulting sound could approach more convincingly that of an ideal string. The instrument makes use of the zak system and, for simplicity, I initialized all the positions to 0 except for one mass. This should be like plucking the string at that point. You could even simulate the pluck and pick-up positions, though I&acute;ve not implemented this possibility. The instrument sets a rich pattern of vibrations, and sounds cool at low damping values.</p>		<p>A problem in the design of the instrument was to clear the <i>zak</i> space at init time, because the values are otherwise kept from note to note. The opcode that should do this, <i>zicl</i>, doesn&acute;t exist yet. I wasn&acute;t sure if <i>igoto + zkcl</i> worked okay for this purpose. So (forgive me) I clear manually the <i>zak</i> space with a second instrument between notes. Other tricks like this could work as well. In particular I thing it would be very elegant to activate an intermediate instrument which could clear the <i>zak</i> space, pick up all the p-fields and store them as global variables, activate a second instrument with the string model via<i> turnon</i> which would pick up those global variables and then quit (<i>turnoff</i>), like</p>		<p>instr 1<br>		gip3 = p3; and all the remaining fields<br>		;here clear the zak space (zkcl)<br>		turnon 2,0; trigger instr 2<br>		turnoff; then quit<br>		endin</p>		<p>instr 2<br>		p3 = gip3<br>		;all the stuff here<br>		endin</p>		<p>but it seems more difficult in practice. However, you can keep the mass distribution at your own risk, that would be more <i>physical </i>maybe.<br>		Forget to use this instrument in polyphonic works, because the zak system would interfere completely, unless you reserve different locations for each overlapped note.<br>		&nbsp;</p>		<ul>			<li><a href="pm5.orc">pm5.orc</a> <a href="pm5.sco">pm5.sco</a>		</ul>		<center>			<p><img src="3dstring.jpg"></p>		</center>		<p>&nbsp;Now suppose the string has a non uniform lynear density, which can be simulated simply by setting arbitrary values from a table to the masses of the system. The same thing can be done initialising the positions to some values derived from another table, something like the Karplus-Strong algorithm, but here with a <i>brute-force</i> method. This is by far one of the most complex instruments I&acute;ve ever written. Notice that, though richly inharmonic, the timbre obtained is perfectly bandlimited, because there aren&acute;t non-linearities in the system.</p>		<p><a href="pm5.mp3">pm5.mp3</a> : just with arbitrary initial positions<br>		<a href="pm5b.mp3">pm5b.mp3</a> : also with arbitrary masses (this is what you&acute;ll get compiling pm5)<br>		<i>(both rendered at 44100 Hz and then compressed to mpeg layer 3)</i><br>		&nbsp;</p>		<ul>			<li><a href="pm6.orc">pm6.orc</a> <a href="pm6.sco">pm6.sco</a>		</ul>		<center>			<p><img src="plate.jpg"></p>		</center>		<p>Let&acute;s try now a different configuration of the masses. In the next dessign I used a plate structure (see fig.). The same could be done with an arbitrary number of masses but it could be too complicated. The sound can range from drum to bells like timbres very convincing.</p>		<ul>			<li><a href="pm7.orc">pm7.orc</a> <a href="pm7.sco">pm7.sco</a>		</ul>		<p>We can introduce some non-linearities in the system to get a richer sound. What in PhyMod is called a simulation of <i>hammer action</i> is merely a conditional statement which bypasses the link (that is, considers two masses phisically independent) when the position of one mass becomes higher (or lower) than the adjacent one. This is supposed to emulate a structure (periodically?) struck (?). Of course introducing a conditional statement causes the generation of massive inharmonic components even in a very simple structure. This is just what I was looking for...</p>		<ul>			<li><a href="pm8.orc">pm8.orc</a> <a href="pm8.sco">pm8.sco</a>		</ul>		<p>Like the previous one but using the string structure of pm5. Cool sound.</p>		<p><a href="pm8.mp3">pm8.mp3</a><br>		&nbsp;</p>		<h3>Conclusions</h3>		<p><i>Much more interesting than simulating instruments that have worked perfectly well for tens or even hundreds of years is to play around with the parameter sets to create instruments that no one has ever heard before.</i> (From PhyMod manual)<br>		</p>		<p>Could be true. In fact the sounds I got from those designs are certainly realistic, but I didn&acute;t expect that sometimes metallic quality. May be the result of an oversimplification of the problem, or maybe a complete erroneus formulation, it doen&acute;t matter.&nbsp; They are wonderful sounds. Very <i>physical  </i>;-) .</p>		<div align="right">			<p>Josep M Comajuncosas</p>			<p>gelida@intercom.es&nbsp;</div>	</body></html>