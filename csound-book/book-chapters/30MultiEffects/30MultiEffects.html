<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"><html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>A Csound Multi-Effects Processor</title>		<!-- SGI_COMMENT COSMOCREATE -->		<!-- SGI_COMMENT VERSION NUMBER="1.0.1" -->		<meta name="AUTHOR" content="End User">		<meta name="OPERATOR" content="End User">	</head>	<body bgcolor="white">		<div align="left">			<h1><b>A Csound Multi-Effects Processor</b></h1>			<h2>Hans Mikelson</h2>		</div>		<h3><b>Introduction</b></h3>		<p>This chapter describes a Csound implementation of a multi-effects processor. Several categories of effects are presented including dynamics processing, filtering and pitch effects. Robin Whittle's <a href="../../../2%20CD1/Reference/Manual4.0/zak/top.htm">zak</a> opcodes provide a flexible method of routing between the effects routines. The <a href="../../../2%20CD1/Reference/Manual4.0/siggen/pluck.htm">pluck</a> opcode is used to demonstrate these effects since many of them are often used with guitar.</p>		<p><b>The Zak System</b></p>		<p>Communication between effects is handled by the <a href="../../../2%20CD1/Reference/Manual4.0/zak/top.htm">zak</a> opcodes. One advantage of the <a href="../../../2%20CD1/Reference/Manual4.0/zak/top.htm">zak</a> system over global variables is that communications between instruments may be reconfigured in the score without making changes to the orchestra. To utilize the <a href="../../../2%20CD1/Reference/Manual4.0/zak/top.htm">zak</a> opcodes they must first be initialized which is done with the following statement: <a href="../../../2%20CD1/Reference/Manual4.0/zak/zakinit.htm">zakinit</a><i> num-a-rate, num-k-rate</i> where <i>num-a-rate</i> and <i>num-k-rate</i> are the number of audio rate and control rate channels allocated.</p>		<p>Communications between effects are accomplished using <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a> and <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>. To write to an audio channel<i> </i><a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a> <i>asig, ichannel</i> is used. To read from an audio channel <i>asig </i><a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a> <i>ichannel </i>is used. Here <i>asig</i> is the audio signal and <i>ichannel</i> is the number of the channel.</p>		<p>The <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zawm</a> opcode mixes the current contents of the audio channel with the new audio data. During a chord several instances of the <a href="../../../2%20CD1/Reference/Manual4.0/siggen/pluck.htm">pluck</a> instrument are active at the same time so the <a href="../../../2%20CD1/Reference/Manual4.0/siggen/pluck.htm">pluck</a> instrument uses <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zawm</a> to accumulate sound. The audio channels must be cleared every sample period or the data will continue to accumulate. The mixer is the last instrument in the orchestra and is used to clear audio channels 0-30 with the statement <a href="../../../2%20CD1/Reference/Manual4.0/zak/zkmod.htm">zacl</a><i> 0, 30</i>.</p>		<p><b>Mixer</b></p>		<p>The mixer reads from four audio channels and provides independent gain and pan control for each channel.</p>		<pre>asig1  <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      p4                                           igl1   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p5*p6                                        igr1   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p5*(1-p6)                                    asig2  <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      p7                                           igl2   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p8*p9                                        igr2   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p8*(1-p9)                                    asig3  <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      p10                                          igl3   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p11*p12                                      igr3   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p11*(1-p12)                                  asig4  <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      p13                                          igl4   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p14*p15                                      igr4   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     p14*(1-p15)                                  asigl  =        asig1*igl1+asig2*igl2+asig3*igl3+asig4*igl4  asigr  =        asig1*igr1+asig2*igr2+asig3*igr3+asig4*igr4  </pre>		<p><b>Dynamics Processing</b></p>		<p>This section describes a compressor, a limiter, a noise gate, a de-esser and a distortion effect.1 These are all related effects which change the dynamics of the sound.</p>		<p><b>Compressor</b></p>		<p>A compressor is used to reduce the dynamic range of a signal. It does this by monitoring the level of an input signal and varying the gain applied to the output signal. Sounds greater than a specified level are reduced in volume. The <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a> opcode can be used to give a time average of the level of the input signal. The output from <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a> is used to reference a table which determines the amount of gain applied to the output signal. A post gain is usually included to restore the level of the output signal after it has been compressed. The <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a> opcode does not respond immediately to changes in level so that sudden attacks are sometimes allowed to pass. To avoid this the original signal is monitored and compression is applied to a time delayed copy of the signal. In this example a delay time equal to one half of the <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a> averaging time is used.</p>		<pre>asig   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      iinch                  ;Read input         kamp   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a>      asig, ifqc             ;Find rms level     kampn  =        kamp/30000             ;Normalize rms      kcomp  <a href="../../../2%20CD1/Reference/Manual4.0/siggen/table.htm">tablei</a>   kampn,itab,1,0         ;Look up compress.  adel1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>   ideltm                 ;Delay for ideltm          <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>   asig                   ;Write to delay     acomp  =        kcomp*adel1*ipostgain  ;Apply compression         <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>      acomp*kenv, ioutch     ;declick &amp; output   </pre>		<p>The amount of compression is given by the compression curve <i>f6</i>. Compression levels of 2:1 and 4:1 are common.</p>		<p><tt>f6 13 1025 7 1 256 1 256 .5 513 .5</tt></p>		<p>The compressor block diagram is presented in figure 1.</p>		<p><img src="DOCS/mltfx1.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx1.gif"></p>		<p><b>Figure 1</b></p>		<p>Compressor/Limiter block diagram.</p>		<p><b>Limiter</b></p>		<p>The limiter is merely a compressor with a very severe compression curve. Limiters prevent a signal level from going above a specified limit. Limiters commonly use compression levels of 10:1 or 100:1. This can be implemented by simply using a different compression table:</p>		<p><tt>f6 13 1025 7 1 256 1 512 .01 129 .01</tt></p>		<p><b>Noise Gate</b></p>		<p>Noise gates are used to remove unwanted background noise and hiss from a signal. A noise gate can be implemented by changing the <i>f6</i> table again.</p>		<p><tt>f6 13 1025 7 0 64 0 0 1 448 1 513 1</tt></p>		<p>In this case signals below a certain level are completely silent. Once they exceed that level they are allowed to pass. Noise gates are sometimes criticized for removing playing dynamics. To solve this problem a delayed signal is used to determine the level and the original signal is modified and output. This results in the gate opening just before playing begins. This technique can also be used on a compressor to prevent compression of initial playing dynamics.</p>		<p><img src="DOCS/mltfx2.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx2.gif"></p>		<p><b>Figure 2</b></p>		<p>Noise Gate block diagram.</p>		<pre>asig   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      iinch                  ;Read from input       adel1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>   ideltm                 ;Delay the signal             <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>   asig                                          kamp   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a>      adel1, ifqc            ;Calculate RMS         kampn  =        kamp/30000             ;Normalize to 0-1      kcomp  <a href="../../../2%20CD1/Reference/Manual4.0/siggen/table.htm">tablei</a>   kampn,itab,1,0         ;Reference the table   acomp  =        kcomp*asig*ipostgain   ; Apply noise gate            <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>      acomp*kenv, ioutch     ;Declick and write     </pre>		<p><b>De-Esser</b></p>		<p>The next effect considered in this section is the de-esser. Certain consonant sounds such as 's' and 'p' produce loud artifacts when a microphone is used. The de-esser is a relative of the compressor which can be used to reduce these artifacts. The de-esser monitors the level of the high frequency component of the signal and applies compression to the signal based on this level. This can be implemented by applying a high pass filter to the input signal and monitoring the level of the filtered signal.</p>		<p><img src="DOCS/mltfx3.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx3.gif"></p>		<p><b>Figure 3</b></p>		<p>De-Esser block diagram.</p>		<pre>asig   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>        iinch                  ;Read input         afilt  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterhp</a>   asig, ifco             ;High pass filter   kamp   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">rms</a>        afilt, ifqc            ;Calculate rms      kampn  =          kamp/30000             ;Normalize rms 0-1  kcomp  <a href="../../../2%20CD1/Reference/Manual4.0/siggen/table.htm">tablei</a>     kampn,itab,1,0         ;Look up in table   adel1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>     ideltm                 ;Delay signal              <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>     asig                                       acomp  =          kcomp*adel1*ipostgain  ;Apply de-ess              <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>        acomp*kenv, ioutch     ;Declick &amp; output   </pre>		<p><b>Distortion</b></p>		<p>This section describes a distortion effect. An amplifier can be considered as having two operating ranges: a linear range, and a non-linear range. In the linear range of operation the output signal is an amplified copy of the input signal. In the non-linear range of operation the output signal is a distorted version of the input signal. Early electronic amplifiers were based on vacuum tubes. Vacuum tube distortion is usually described as warmer and more musical than other types of distortion.2</p>		<p>If a sine wave signal is passed through an overdriven tube amplifier the resulting waveform differs from the original in several ways. The top of the waveform becomes flattened or clipped. The bottom of the waveform is also flattened although not as much as the top. The duty cycle of the waveform is also shifted so that the upper part of the curve is not the same width as the lower part of the curve. The resulting shape is approximated in figure 1.</p>		<p><img src="DOCS/mltfx4.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx4.gif"></p>		<p><b>Figure 4</b></p>		<p>Waveform of a sine wave processed through a tube amplifier.</p>		<p>Waveshaping may be used to reshape the input waveform to resemble figure 4. For slight distortion use the following table:</p>		<p><tt>f5 0 8192 8 -.8 336 -.78 800 -.7 5920 .7 800 .78 336 .8</tt></p>		<p>For heavy distortion use the following table:</p>		<p><tt>f5 0 8192 7 -.8 934 -.79 934 -.77 934 -.64 1034 -.48 520 .47 2300 .48 1536 .48</tt></p>		<p>A shifted duty cycle can be accomplished by implementing an amplitude dependent delay line.</p>		<p><img src="DOCS/mltfx5.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx5.gif"></p>		<p><b>Figure 5</b></p>		<p>Distortion block diagram.</p>		<pre>asigin  <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      izin                                        aold    =        asig                                        asig    =        igaini*asigin/60000                         aclip   <a href="../../../2%20CD1/Reference/Manual4.0/siggen/table.htm">tablei</a>   asig,5,1,.5                                 aclip   =        igainf*aclip*15000                          atemp   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>   .1                                          adel1   deltapi  (2-iduty*asig)/1500+islope*(asig-aold)/300          <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>   aclip                                               <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>      adel1, izout                                </pre>		<p><b>Filtering Effects</b></p>		<p>This section describes an equalizer, a wah-wah and a resonant low pass filter.</p>		<p><b>Equalizer</b></p>		<p>An equalizer can be used to increase or decrease the level of different frequencies in a signal. In this example a three band equalizer is implemented. The <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterlp</a> and <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterhp</a> opcodes are used to isolate the low and high frequency components of the signal. The midrange component is isolated by high pass filtering above the low pass cut off frequency and low pass filtering below the high pass cut off frequency. Individual gains are applied to each of the three signal components before they are added together and output.</p>		<p><img src="DOCS/mltfx6.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx6.gif"></p>		<p><b>Figure 6</b></p>		<p>3 Band Equalizer block diagram.</p>		<pre>alosig   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterlp</a>   asig, ilofco             ;Low pass       atmpsig  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterhp</a>   asig, ilofco-ilofco/4    ;Midrange 1     amidsig  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterlp</a>   atmpsig,                 ;Midrange 2                         ihifco+ihifco/4                          ahisig   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterhp</a>   asig, ihifco             ;Hi pass        aout     =    ilogain*alosig+imidgain*amidsig+ihigain*ahisi               g                                             </pre>		<p><b>Wah-Wah</b></p>		<p>A wah-wah pedal is a type of low-pass filter which incorporates several resonances to give it a unique character. In this example several resonances derived from vowel sounds &quot;ahh&quot; and &quot;ooh&quot; are used to add character to the standard low pass filter sound. The vowel &quot;ahh&quot; has resonances and amplitudes of 730 Hz -1 db, 1090 Hz -5 db, 2440 Hz -28 db. The vowel &quot;ooh&quot; has resonances of 300 Hz -3 db, 870 Hz -19 db, 2240 Hz -43 db. As the frequency is swept from high to low the resonances are swept from &quot;ahh&quot; to &quot;ooh.&quot;</p>		<p><img src="DOCS/mltfx7.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx7.gif"></p>		<p><b>Figure 7</b></p>		<p>Wah-Wah</p>		<pre>kosc1     <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>     .5,irate,itab1,.25    ;Oscilator          kosc2     =         kosc1 + .5            ;Rescale for 0-1    kosc3     =         kosc2                 ;Formant Depth 0-1  klopass   =         idepth*kosc2+ilow     ;Filter range       kform1    =         430*kosc2 + 300       ;Formant 1 range    kamp1     =         ampdb(-2*kosc3 + 59)*ifmix  ;F1 level     kform2    =         220*kosc2 + 870             ;F2 range     kamp2     =         ampdb(-14*kosc3 +           ;F2 level                         55)*ifmix                                 kform3    =         200*kosc2 + 2240            ;F3 range     kamp3     =         ampdb(-15*kosc3 +           ;F3 level                         32)*ifmix                                 afilt     <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/butterhp.htm">butterlp</a>  asig, klopass               ;Low pass     ares1     <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/port.htm">reson</a>     afilt, kform1, kform1/8     ;Apply        ares2     <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/port.htm">reson</a>     afilt, kform2, kform1/8     ;formant      ares3     <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/port.htm">reson</a>     afilt, kform3, kform1/8     ;filters 1-3  aresbal1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">balance</a>   ares1, afilt                ;Restore      aresbal2  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">balance</a>   ares2, afilt                ;balance      aresbal3  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/rms.htm">balance</a>   ares3, afilt                              aout      =         afilt+kamp1*aresbal1        ;Add signals  aout      =         aout+kamp2*aresbal2+kamp3*aresbal3        </pre>		<p><b>Resonant Low Pass Filter</b></p>		<p>Some theory of resonant filters can be found in the chapter &quot;Classic Keyboard Instruments&quot; and will not be discussed here in detail. This implementation uses the <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/nlfilt.htm">nlfilt</a> opcode which avoids the need of setting kr=sr and also provides for simpler code. This filter is designed to resonate for approximately the same amount of time no matter what the cut-off frequency is.</p>		<p><img src="DOCS/mltfx8.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx8.gif"></p>		<p><b>Figure 8</b></p>		<p>Low pass resonant filter block diagram.</p>		<pre>kfco    <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>    1,1/idur,itab1 ;Cut-off frequency sweep     kfcort  =        sqrt(kfco)  ;by table 1                     krezo   <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>    1,1/idur,itab2 ;Resonance sweep             krez     =       krezo*kfco/500 ;by table 2                  kamp    <a href="../../../2%20CD1/Reference/Manual4.0/siggen/line.htm">linseg</a>   0, .002, 1, p3-.004, 1, .002, 0  ;Declick   axn     <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      izin                                        ka1     =        1000/krez/kfco-1 ;Resonant lp filter        ka2     =        100000/kfco/kfco                            kb      =        1+ka1+ka2                                   ay1     <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/nlfilt.htm">nlfilt</a>   axn/kb, (ka1+2*ka2)/kb, -ka2/kb, 0, 0, 1    ay      <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/nlfilt.htm">nlfilt</a>   ay1/kb, (ka1+2*ka2)/kb, -ka2/kb, 0, 0, 1    ka1lp   =        1000/kfco-1  ;Low pass filter               ka2lp   =        100000/kfco/kfco                            kblp    =        1+ka1lp+ka2lp                               ay1lp   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/nlfilt.htm">nlfilt</a>   axn/kblp,(ka1lp+2*ka2lp)/kblp,ka2lp/kblp,0,                  0,1                                         aylp    <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/nlfilt.htm">nlfilt</a>   ay1lp/kblp,(ka1lp+2*ka2lp)/kblp,ka2lp/kblp,                  0,0,1                                       ayrez   =        ay - aylp  ;Extract the resonance           ayrz    =        ayrez/kfco  ;Adjust res. gain               ay2     =        aylp*6*ilpmix + ayrz*300*irzmix ;Mix Q &amp;                     LP                                          </pre>		<p><b>Pitch Effects</b></p>		<p>This section describes vibrato, pitch shifting, chorus and flanging effects. All of these effects make use of delay lines whose delay times are modulated with an oscillator. An interpolating delay tap, <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/deltap.htm">deltapi</a>, is used to allow continuous variation of the delay time.</p>		<p><b>Vibrato</b></p>		<p>Vibrato can be accomplished by modulating a variable delay tap with a sine wave. When the delay tap sweeps forward in the same direction as the signal the pitch is lowered. As the delay tap sweeps backwards in the opposite direction of the signal the pitch is raised.</p>		<p><img src="DOCS/mltfx9.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx9.gif"></p>		<p><b>Figure 9</b></p>		<p>Vibrato block diagram.</p>		<pre>asig   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>       izin               kosc   <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>     iamp, ifqc, itab1  atemp  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>    imax               aout   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/deltap.htm">deltapi</a>   kosc+imax/2               <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>    asig                      <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>       aout, izout        </pre>		<p><b>Pitch Shifting</b></p>		<p>A simple type of pitch shifting can be implemented with a variable length interpolating delay tap. The delay time is modulated with a sawtooth wave whose amplitude is equal to the wavelength of the sound. This results in a resampling of the wave form with linear interpolation between successive samples. Lowering the pitch results in cycles being discarded periodically. Raising the pitch results in some cycles being repeated. In order to produce a good quality sample the wavelength of the sound must be known. In this example it is simply supplied when the instrument is called.</p>		<p><img src="DOCS/mltfx10.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx10.gif"></p>		<p><b>Figure 10</b></p>		<p>Pitch Shifter block diagram.</p>		<pre>klfo   <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>     1/kfqc, ipsh*kfqc, itab1                    atemp  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>    1/ifqc                                      atap1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/deltap.htm">deltapi</a>   klfo                                               <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>    aosc                                        </pre>		<p><b>Chorus</b></p>		<p>Chorus is an effect which attempts to make one instrument sound like more than one instrument. The resulting sound is thicker than the original sound. Chorus can be implemented by adding the original signal to a frequency modulated delayed signal3. The signal is typically delayed between 20 and 30 msec. Gain is applied to control the amount of mix between the original signal and the delayed signal. Common waveforms used to modulate the signal are sine, triangle and logarithmic waves.</p>		<p><img src="DOCS/mltfx11.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx11.gif"></p>		<p><b>Figure 11</b></p>		<p>Chorus block diagram.</p>		<pre>kamp    <a href="../../../2%20CD1/Reference/Manual4.0/siggen/line.htm">linseg</a>   0, .002, 1, p3-.004, 1, .002, 0             asig   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>       izin                                        aosc1  <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>     idepth, irate, iwave, iphase                aosc2  =         aosc1+ideloff                               atemp  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>    idepth+ideloff                              adel1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/deltap.htm">deltapi</a>   aosc2                                              <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>    asig                                        aout   =         (adel1*imix+asig)/2*kamp                           <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>       aout, izout                                 </pre>		<p>A stereo chorus effect can be created by having two choruses one quarter cycle out of phase of each other and sending the output of each to a separate channel. Many choruses can be combined with different phases, waveforms and delay times to produce a very rich sound.</p>		<p>; Sta Dur Rate Depth Wave Mix Delay Phase InCh OutCh</p>		<p>i35 2 1.6 .5 2 1 1 25 0 2 3</p>		<p>i35 2 1.6 .5 2 1 1 20 .25 2 4</p>		<p><b>Flanger</b></p>		<p>Flanging was originally produced by taking two tapes with the same music on them and playing at them at the same time. By pushing on the flanges of one of the tape reels the playback speed of one of the copies of the sound was modulated. This detuning of the signal results in areas of constructive and destructive interference as the different frequencies move in and out of phase with each other. This produces notches in the audio spectrum. As the frequency of the modulated signal is swept back and forth these notches move closer together and farther apart. This produces the characteristic &quot;jet airplane&quot; effect. In this implementation the original signal is added to a delayed signal. The delay time is modulated by a sine wave so that the pitch of the delayed signal is modulated. The combined signal is then fed back into the beginning of the delay path which makes a more pronounced flanging effect. Typical delay times are 10 msec.</p>		<p><img src="DOCS/mltfx12.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx12.gif"></p>		<p><b>Figure 12</b></p>		<p>Flanger block diagram.</p>		<pre>asig1  =         asig+ifdbk*adel1                            aosc1  <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>     idepth, irate, iwave, iphase                aosc2  =         aosc1+ideloff                               atemp  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>    idepth+ideloff                              adel1  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/deltap.htm">deltapi</a>   aosc2                                              <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>    asig1                                       aout   =         (imix*adel1+asig)/2                         </pre>		<p>A stereo flanger can be implemented by running two flangers at one quarter cycle out of phase from each other and sending each to a separate channel as follows:</p>		<p><tt>; Sta Dur Rate Depth Wave Feedbk Mix Delay Phase InCh OutCh</tt></p>		<p><tt>i30 4 1.6 .5 1 1 .8 1 1 0 2 3</tt></p>		<p><tt>i30 4 1.6 .5 1 1 .8 1 1 .25 2 4</tt></p>		<p><b>Miscellaneous Effects</b></p>		<p>This section describes a digital delay, a panner, a tremolo effect and simple reverb effect.</p>		<p><b>Stereo Delay</b></p>		<p>This section describes a stereo delay with cross feedback. The <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a> and <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a> opcodes provide a straight forward implementation of this. The right and left channels are delayed independently. The delayed signal from each channel may be mixed with the original signal either channel.</p>		<p><img src="DOCS/mltfx13.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx13.gif"></p>		<p><b>Figure 13</b></p>		<p>Stereo Delay block diagram.</p>		<pre>aoutl   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     0                                           aoutr   <a href="../../../2%20CD1/Reference/Manual4.0/syntax/assign.htm">init</a>     0                                           asigl   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      izinl                                       asigr   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>      izinr                                       aoutl   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>   itim1                                               <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>   asigl+ifdbk1*aoutl+ixfdbk1*aoutr            aoutr   <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayr</a>   itim2                                               <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/delayr.htm">delayw</a>   asigr+ifdbk2*aoutr+ixfdbk2*aoutl                    <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>      aoutl, izoutl                                       <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>      aoutr, izoutr                               </pre>		<p><b>Tremolo</b></p>		<p>Tremolo is usually considered to be a periodic variation in the volume of a sound. This can be implemented by generating a low frequency oscillating sine wave between 0 and 1 in amplitude and simply multiplying the input signal by this.</p>		<p><img src="DOCS/mltfx14.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx14.gif"></p>		<p><b>Figure 14</b></p>		<p>Tremolo block diagram.</p>		<pre>kosc   <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>  iamp, ifqc, itab1                              aout   =      asig*(kosc+1)                                  </pre>		<p>A square wave can be used to generate an amplitude gated sound.</p>		<p><b>Panner</b></p>		<p>A panner can be implemented by multiplying one channel by a low frequency sine wave and multiplying the other channel by one minus the low frequency sine wave so that the channels are 180 degrees out of phase with each other. This way the signal is swept from one channel to the other by the oscillator.</p>		<p><img src="DOCS/mltfx15.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/multifx/mltfx15.gif"></p>		<p><b>Figure 15</b></p>		<p>Panner block diagram.</p>		<pre>asig   <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>     izin                                          kosc   <a href="../../../2%20CD1/Reference/Manual4.0/siggen/oscil.htm">oscil</a>   iamp, ifqc, itab1                             kpanl  =       (kosc+1)/2                                    kpanr  =       1-kpanl                                       aoutl  =       asig*kpanl                                    aoutr  =       asig*kpanr                                           <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>     aoutl, izoutl                                        <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>     aoutr, izoutr                                 </pre>		<p><b>Reverb</b></p>		<p>All sound produces some type of reverberation as the sound waves are reflected and absorbed on surfaces in the listening environment. The type of reverb depends on the size, shape and material of the area in which the sound is produced. A concert hall can produce a very rich spacious reverb. Artificial reverb is often added to signals to make them sound as if they were generated in a specific type of area such as a concert hall. Reverberation can be simulated by using a combination of all pass filters, comb filters and delays. Csound provides a <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/reverb2.htm">reverb2</a> opcode for generating simple reverbs. This is used in the following instrument to create a very simple reverb. There are many excellent examples of reverb available in the Csound archives which can be modified to work with the system presented in this chapter.</p>		<pre>asig  <a href="../../../2%20CD1/Reference/Manual4.0/zak/zir.htm">zar</a>     izin                                           aout  <a href="../../../2%20CD1/Reference/Manual4.0/sigmod/reverb2.htm">reverb2</a> asig, irvtime, irvfqc                                <a href="../../../2%20CD1/Reference/Manual4.0/zak/ziw.htm">zaw</a>     aout/5, izout                                  </pre>		<p><b>Conclusion</b></p>		<p>Hopefully this section has provided insight into the theory and implementation of many of the most popular sound effects and has provided inspiration for further audio experiments. Some further ideas to try would be to use different waveforms with the pitch based effects, try calling the chorus routine many times with different parameters and waveforms to produce a dense chorusing effect. Try setting up different types of distortion and then devise an instrument to oscillate between them. Add attack and decay envelopes to the dynamics effects. If you have a fast computer one of the first things you may wish to do is to implement real-time input and output for the effects.</p>		<p><b>References</b></p>		<p>1. Lehman, S. <i>Effects Explained. </i>http://www.harmony-central.com/Effects/.</p>		<p>2. Hamm, R., O.<i> </i>&quot;Tubes Versus Transistors - Is There an Audible Difference?&quot;, <i>Journal of the Audio Engineering Society</i>, May 1973.</p>		<p>3. Cronin, Dennis &quot;Examining Audio DSP Programs,&quot; <i>Dr. Dobb's Journal</i>, July 1994.	</body></html>