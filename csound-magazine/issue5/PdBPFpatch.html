<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head>      <title>Csound Journal</title>  <link href="csoundJournal.css" rel="stylesheet" type="text/css"></head><body><div id="wrap"><div id="navigation"> CSOUND JOURNAL: <a href="../index.html">Home</a> |&nbsp;<a href="index.html">Issue 5</a> </div><div id="header"><h2>A Pure Data Break Point Function patch</h2>    James Hearon<br>j_hearon AT hotmail.com</div><div id="content"><h2>Introduction</h2>This article describes a <i>Pure Data</i> patch which is a data structure holding an array of graphical break points.  The array's data is traversed and fed into a subpatch which formats the numbers for a <i>Csound</i> Gen07 ftable.  The table can then be sent to a <i>Csound</i> file using the <i>csoundapi~</i> object for <i>Pure Data</i> and the "event" opcode from <i>Csound</i>. This patch follows the work of Matt Ingalls, and his "csound~events" patch example for<i> Max/Msp</i>. Victor Lazzarini also wrote <i>csoundapi~</i>, a class for <i>Pure Data</i> whichis based on the <i>Csound API</i>, and provides similar functionality to  <i>csound~</i> for <i>Max/Msp</i> by Matt Ingalls.  The current <i>Max/Msp</i> class is <i>csound~</i> by DavisPyon.&nbsp;<h2>I. Background <br></h2>The <i>Max/Msp</i> interface includes a graphical break point object which greatly facilitates designing a patch employing break point functions.  There are several other <i>Max/Msp</i> objects or messages, such as "sprintf", and "prepend append"which can help with printing and formatting array data.  For <i>Pure Data</i> some of this functionality can be obtained using additional libraries such as <i>Flext</i>, and <i>Cyclone</i>, which are also included in the <i>Pure Data extended</i> version.  The <i>Pure Data </i>"table" object could also be employed in designing graphical interfaces, such as for employing a <i>Csound</i> Gen01 input. <br><br>In this patch an attempt was made to remain true to Miller Puckette's versionof <i>Pure Data</i>, and to employ data structures to build a graphical break point function suitable for Gen07 input which requires length of segments as 'n' storage locations in the even numbered pfields (see the <i>Csound Manual</i> for Gen07 description).  Data structures are somewhat abstract and can be difficult to debug since help examples may not be applicable to the patch you are attempting to design, but the possibility of employing graphic objects with filled polygons, colors, and line thicknesses etc. in a graph is enticing enough to seek solutions for employing data structures.<br><h2>II. Description of the Patch <br></h2>In the patch, three data structures are declared as "pd data", "pd mytemplate", and "pd array1-template".  The data structure "pd data" holds the graph which is also where manual editing of data points is allowed.  To view the graph, in the demo patch, double click the data structure.<br><br> <p align="center"><img height="208" alt="" src="images/dataStructs.jpg"  width="259" border="0"></p> <br>		<p align="center"><img src="images/pd_data.jpg" width="352" height="242" 	alt="" border="0"></p><br>	The second data structure "pd mytemplate"  holds a struct object with floating point values x and y, and an array which is itself a struct in the third data structure "pd array1-template".  The second data structure includes the "plot" object which plots x and y values for the graph as a whole, while the third data structure includes the individual polygon objects of the graph.	<br><br><p align="center"><img src="images/pd_mytemplate.jpg" width="447" height="219" alt="" border="0"></p><br><p align="center"><img src="images/pd_array1_template.jpg" width="417" height="218" alt="" border="0"></p>	<br>One difficulty in reverse engineering example data structures patches is simply copying, pasting and renaming objects often looses the data which is unrecoverable unless you generally have some way to initialize the data structures.  In the demo patch two methods are employed for initialization.  One method loads a file from disk, and also allows you to save a break point function graph to disk as a text file which includes data structure information.  The second method clears the data structure and appends a new initial point to the graph.<br><br><p align="center"><img src="images/init.jpg" width="472" height="392" alt="" border="0"></p><br><br>In addition to initialization, important to the operation of data structures is the ability to traverse the data structure using a "pointer" object in order to act on the data using objects such as "setsize" and "get".  Thus after making any changes on the break point function graph, such as moving the location of a point, or adding points, you must traverse the data structure using a pointer.<br><br><p align="center"><img src="images/traverse.jpg" width="540" height="221" alt="" border="0"></p><br><br>When adding additional break points to the graphical data structure using the setsize object, a difficulty arises in where the new polygons are placed due to the fact that the third data structure includes x and y coordinates.  Viewing the values of the data structure by selecting a point and viewing properties can provide some additional text information on the data points and their current x and y locations.  This is also important for making sure the data points are in successive order, for Gen7 ftable input, and is the information which is saved to disk when selecting the "readit" object, from above.<br><br><p align="center"><img src="images/Properties.jpg" width="436" height="495" alt="" border="0"></p><br><br>The values obtained from the graph are more suitable for drawing figures and shapes, and interpreting those musically in someway, rather than functioning as a true break point function editor.  This is where the <i>Max/Msp</i> object excels with its point and click method of adding data points, and also where a <i>Pure Data</i> "table" object could be an easier approach to other types of Gen routine input where one can set the type of line or points, and range to be used within the table.  <br><br>Important for Gen07 input is the <i>Pure Data</i> "element" object used along the "get" object.  When combined with a "pointer" object to traverse the data structure which includes the graph of polygon points, the use of "element" and "get" will provide an index to the points which can be used to extract the length of the segment between the data points.<br><br><p align="center"><img src="images/Element_Get.jpg" width="509" height="563" alt="" border="0"></p><br><br>The gen7 subpatch does the work of formatting the numbers from the data structure into a <i>Pure Data</i> message, which when used with the "event" opcode, and the proper formatting for Gen07 can be used to send data to a <i>Csound</i> instrument via the <i>csoundapi~</i> object.   Some differences here from the <i>Max/Msp</i> patch by Matt Ingalls are the use of "sprintf" and also the use of "prepend append".  <br><br>The ftable number inlet takes the number of the table, passes it thru as a float variable and packs it with the number of points before setting it as a message to be appended the list.  The list is trimmed and "set" is removed before being sent to the outlet, which returns the list to a regular message.<br><br>The number of points inlet is the number of samples in the ftable.  The path is the same as above for the ftable inlet except that when only the table number of points is altered, it also bangs to trigger the table number as well.<br><br>The clear inlet triggers a message which sends '0' as input to the receiver objects.  The clear message triggers a "bang" to the "list prepend" object to prepend zeros to the list, then the clear message is sent again to force the zeros thru the list.<br><br>For the x and y inlets, the input values are the traversed data points from the "pd data" window.  The last value of x is subtracted from the previous value for a Gen07 length of segment input.  The values x and y are packed and prepended to a list, and as the x y pairs continue to grow, the list is appended.  The list is then split to remove initial zeros and the remainder is appended to the basic four pfields of the set message for the ftable number and number of points, before set is trimmed off the list and the whole thing is sent to the subpatch outlet as a message.<br><br><img src="images/Gen07.jpg" width="713" height="650" alt="" border="0"><br><br>The formatted score f-statement with the opcode event at the beginning of the message generates a score event from the <i>Pure Data</i> patch.  The ftable message is formatted for a Gen07 routine, and generates waveform functions from segments as straight lines. The message is sent as an inlet to the <i>csoundapi~</i> library object which also lists the .csd file, to which the event message is sent, as an argument.<br><br>Another message is also sent to the <i>csoundapi~</i> library object to generates score event notes or i-statements.  Playing the short melodic fragment generated by this message after firing a new Gen07 table message should allow the user to hear differences in waveform shapes generated by altering the polygons as break point functions on the graph.<br><br><p align="center"><img src="images/csoundapi.jpg" width="609" height="542" alt="" border="0"></p><br><br>The <i>Csound</i> BPFdemo.csd file employed in the background, to receive the events from the<i>csoundapi~</i> object is simple and straightforward.  Basically it runs by means of an f0 statement in the score for a certain amount of seconds, allowing the "event"opcode time to generate a score event as ftable (Gen07), and i- or note eventswhich are sent as messages from the <i>Pure Data</i> patch.<pre>&lt;CsoundSynthesizer&gt;&lt;CsOptions&gt;&lt;/CsOptions&gt;&lt;CsInstruments&gt;sr= 44100kr = 4410ksmps = 10nchnls= 2	instr 1asig oscili	3000, cpspch(p4), 1outs asig, asig	endin&lt;/CsInstruments&gt;&lt;CsScore&gt;f0 6000 f1 0 512 10 1; sine wave&lt;/CsScore&gt;&lt;/CsoundSynthesizer&gt;</pre> <br>For more details and information you can download the full patch here: <a href="PdBPFdemo.zip">PdBPFdemo.zip</a><h2>Conclusion</h2>The <i>csoundapi~</i> object for <i>Pure Data</i>, as well as the <i>Csound</i> software bus opcodes and event generating opcodes have opened access to <i>Csound</i> as synthesis engine for the <i>Pure Data</i> interface.  While building patches to take advantage of those capabilities are useful and informative, we depend upon the nature of development in thehost program to retain compatibility through various upgrades and changes.  The idea of a <i>Pure Data</i> break point function object, similar to the one in <i>Max/Msp</i> , is an idea worth pursuing.<br><br><h2>References</h2>Ingalls, Matt. "csound~events", an example patch from Matt's <i>Csound</i> <i>Max/Msp</i> object package. <a href="http://www.csounds.com/matt/">http://www.csounds.com/matt/</a> (07 October 2006).  <br> <br>Lazzarini, Victor. <i>csoundapi~</i>, from <i>Csound</i> version 5.03,  <a href="http://www.csounds.com/">http://www.csounds.com/</a> (released 15 August 2006).<br><br>Puckett, Miller. <i>Pure Data</i>.<a href="http://crca.ucsd.edu/~msp/software.html">http://crca.ucsd.edu/~msp/software.html</a> (07 October 2006).   <br><h2>Resources</h2><i>Pure Data extended</i> (see "downloads" on the Pd Wiki for the sourceforge link): <a href="http://puredata.info/downloads/">http://puredata.info/downloads/</a><br><br>Davis Pyon's current <i>csound~</i> object for <i>Max/Msp</i> is available at: <a href="http://www.csounds.com/">http://www.csounds.com/</a> <br><br><i>Max/Msp</i> is a licensed, commercial software product and is available for purchase from: <a href="http://www.cycling74.com/">http://www.cycling74.com/</a></div></div></body></html>