<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<title>Toots</title>		<meta name="generator" content="Adobe GoLive 4">	</head>	<body bgcolor="white">		<div align="left">			<h1><b>A FOF Synthesis Tutorial</b></h1>			<h2><b>J. M. Clarke</b></h2>			<p>The <b>fof</b> synthesis generator in Csound has more parameter fields than other modules. To help the user become familiar with these parameters this tutorial will take a simple orchestra file using just one <b>fof</b> unit-generator and demonstrate the effect of each parameter in turn. To produce a good vocal imitation, or a sound of similar sophistication, an orchestra containing five or more <b>fof</b> generators is required and other refinements (use of random variation of pitch etc.) must be made. The sounds produced in these initial explorations will be much simpler and consequently less interesting but they will help to show clearly the basic elements of <b>fof</b> synthesis. This tutorial assumes a basic working knowledge of Csound itself. The specification of the <b>fof</b> unit-generator (as found in the reference section of this manual) is:</p>		</div>		<p>ar <b>fof</b> xamp,&nbsp;xfund, xform, koct, kband, kris, kdur,\\ kdec, iolaps, ifna, ifnb, itotdur, [iphs,\\ [ifmode]]</p>		<div align="justify">			<p>where:</p>			<p><i>xamp, xfund, xform </i>&#151; can receive any rate (constant, control or audio)<i><br>			koct, kband, kdris, kdur, kdec</i> &#151; can receive only constants or control rates<i><br>			iolaps, ifna, ifnb, itotdur</i> &#151; must be given a fixed value at initialization<i><br>			iphs, ifmode</i> &#151; are optional, defaulting to 0.</p>			<p>The following orchestra contains a simple instrument we will use for exploring each parameter in turn. On the faster machines (DECstation, SparcStation, SGI Indigo) it will run in real time.</p>			<p><b>			<table border="0" cellpadding="1" cellspacing="0" width="100%">				<tr>					<td colspan="4"><b>sr</b> <b>= </b>44100</td>				</tr>				<tr>					<td colspan="4"><b>kr</b> <b>=</b> 4410</td>				</tr>				<tr>					<td colspan="4"><b>ksmps</b> <b>=</b> 10</td>				</tr>				<tr>					<td><br>					</td>					<td></td>					<td></td>					<td></td>				</tr>				<tr>					<td><b>instr</b> 1</td>					<td></td>					<td></td>					<td></td>				</tr>				<tr>					<td></td>					<td>a1</td>					<td><b>fof</b></td>					<td>15000, 200, 650, 0, 0, .003, .02, .007, 5, 1, 2, p3</td>				</tr>				<tr>					<td></td>					<td><b>out</b></td>					<td>a1</td>					<td></td>				</tr>				<tr>					<td><b>endin</b></td>					<td></td>					<td></td>					<td></td>				</tr>			</table>			<br>			</b></p>			<p>It should be run with the following score:</p>			<p><b>			<table border="0" cellpadding="1" cellspacing="0" width="100%">				<tr>					<td>f1</td>					<td>0</td>					<td>4096&nbsp;</td>					<td>10&nbsp;</td>					<td>1</td>					<td></td>					<td></td>					<td></td>				</tr>				<tr>					<td>f2&nbsp;</td>					<td>0</td>					<td>1024&nbsp;</td>					<td>19&nbsp;</td>					<td>.5&nbsp;</td>					<td>.5&nbsp;</td>					<td>270&nbsp;</td>					<td>.5</td>				</tr>				<tr>					<td>i1&nbsp;</td>					<td>0</td>					<td>3</td>					<td></td>					<td></td>					<td></td>					<td></td>					<td></td>				</tr>				<tr>					<td>e</td>					<td></td>					<td></td>					<td></td>					<td></td>					<td></td>					<td></td>					<td></td>				</tr>			</table>			</b><br>			</p>			<p>The result is very basic. This is not surprising since we have created only one formant region (a vocal imitation would need at least five) and have no vibrato or random variation of the parameters. By varying one parameter at a time we will help the reader learn how the unit-generator works. Each of the following &quot;variations&quot; starts from the model. Parameters not specified remain as given.</p>			<p>&nbsp;<i>xamp</i> &#151; amplitude</p>			<p>The first input parameter controls the amplitude of the generator. At present our model uses a constant amplitude, this can be changed so that the amplitude varies according to a line function:</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>a2</td>				<td><b>linseg</b></td>				<td>0,&nbsp; p3*.3,&nbsp; 20000,&nbsp; p3*.4,&nbsp; 15000,&nbsp; p3*.3,&nbsp; 0</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>a2, ......(as before)...</td>			</tr>		</table>		</b><br>		</p>		<div align="justify">			<p>The amplitude of a <b>fof</b> generator needs care. <i>xamp</i> does not necessarily indicate the maximum output, which can also depend on the rise pattern, bandwidth, and the presence of any &quot;overlaps.&quot;&nbsp;</p>			<p><i>xfund</i> &#151; fundamental frequency</p>			<p>This parameter controls the pitch of the fundamental of the unit generator. Starting again from the original model this example demonstrates an exaggerated vibrato:</p>			<p><b>			<table border="0" cellpadding="1" cellspacing="0" width="100%">				<tr>					<td>a2</td>					<td><b>oscil</b></td>					<td>20,&nbsp; 5,&nbsp; 1</td>				</tr>				<tr>					<td>a1</td>					<td><b>fof</b></td>					<td>15000,&nbsp; 200+a2,&nbsp; etc........</td>				</tr>			</table>			</b><br>			</p>			<p><b>fof</b> synthesis produces a rapid succession of (normally) overlapping excitations or granules. The fundamental is in fact the speed at which new excitations are formed and if the fundamental is very low, these excitations are heard as separate granules. In this case the fundamental is not so much a pitch as a pulse speed. The possibility of moving between pitch and pulse, between timbre and granular texture is one of the most interesting aspects of <b>fof</b>. For a simple demonstration try the following variation. It will be especially clear if the score note is lengthened to about 10 seconds.</p>			<p><b>			<table border="0" cellpadding="1" cellspacing="0" width="100%">				<tr>					<td>a2</td>					<td><b>expseg</b></td>					<td>5,&nbsp; p3*.8,&nbsp; 200,&nbsp; p3*.2,&nbsp; 150</td>				</tr>				<tr>					<td>a1</td>					<td><b>fof</b></td>					<td>15000,&nbsp; a2&nbsp; etc........</td>				</tr>			</table>			</b><br>			</p>			<p><i>koct</i> &#151; octaviation coefficient</p>			<p>Skipping a parameter, we come to an unusual means of controlling the fundamental: <i>octaviation</i>. This parameter is normally set to 0. For each unit increase in <i>koct</i> the fundamental pitch will drop by one octave. The change of pitch is <b>not</b> by the normal means of glissando, but by gradually fading out alternate excitations (leaving half the original number). Try the following (again with the longer note duration):</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>k1</td>				<td><b>linseg</b></td>				<td>0, p3*.1, 0,&nbsp;p3*.8, 6, p3*.1, 6</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000, 200, 650,&nbsp;k1, etc........</td>			</tr>		</table>		</b><br>		</p>		<div align="justify">			<p>This produces a drop of six octaves; if the note is sufficiently long you should be able to hear the fading out of alternate excitations towards the end.</p>			<p><i>xform</i> &#151; formant frequency<i><br>			ifmode</i> &#151; formant mode (0 = striated, non-0 = smooth)</p>			<p>The spectral output of a <b>fof</b> unit-generator resembles that of an impulse generator filtered by a band pass filter. It is a set of partials above a fundamental <i>xfund</i> with a spectral peak at the formant frequency <i>xform</i>. Motion of the formant can be implemented in two ways. If <i>ifmode</i> = 0, data sent to <i>xform</i> has effect only at the start of a new excitation. That is, each excitation gets the current value of this parameter at the time of creation and holds it until the excitation ends. Successive overlapping excitations can have different formant frequencies, creating a richly varied sound. This is the mode of the original CHANT program. If <i>ifmode</i> is non-zero, the frequency of each excitation varies continuously with <i>xform</i>. This allows glissandi of the formant frequency. To demonstrate these differences we take a very low fundamental, so that the granules can be heard separately and the formant frequency is audible not as the center frequency of a &quot;band&quot; but as a pitch in its own right. Compare the following in which only <i>ifmode</i> is changed:</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>a2</td>				<td><b>line</b></td>				<td>400,&nbsp; p3,&nbsp; 800</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000, 5, a2, 0, 1, .003, .5, .1, 3, 1, 2, p3, 0, 0</td>			</tr>			<tr>				<td><br>				</td>				<td></td>				<td></td>			</tr>			<tr>				<td>a2</td>				<td><b>line</b></td>				<td>400,&nbsp; p3,&nbsp; 800</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000, 5, a2,&nbsp;0,&nbsp;1,&nbsp;.003,&nbsp;.5,&nbsp;.1,&nbsp;3,&nbsp;1,&nbsp;2, p3,&nbsp;0,&nbsp;1</td>			</tr>		</table>		</b><br>		In the first case, the formant frequency moves by step at the start of each excitation, whereas in the second it changes smoothly. A more subtle difference is perceived with higher fundamental frequencies. (Note that the later <b>fof</b> parameters were changed in this example to lengthen the excitations so that their pitch could be heard easily.)</p>		<div align="justify">			<p><i>xform</i> also permits frequency modulation of the formant frequency. Applying FM to an already complex sound can lead to strange results, but here is a simple example:</p>			<p><b>			<table border="0" cellpadding="1" cellspacing="0" width="100%">				<tr>					<td>acarr</td>					<td><b>line</b></td>					<td>400,&nbsp;p3, 800</td>				</tr>				<tr>					<td>index</td>					<td><b>=</b></td>					<td>2.0</td>				</tr>				<tr>					<td>imodfr</td>					<td><b>=</b></td>					<td>400</td>				</tr>				<tr>					<td>idev</td>					<td><b>=</b></td>					<td>index * imodfr</td>				</tr>				<tr>					<td>amodsig</td>					<td><b>oscil</b></td>					<td>idev, imodfr, 1</td>				</tr>				<tr>					<td>a1</td>					<td><b>fof</b></td>					<td>15000,&nbsp;5,&nbsp;acarr+amodsig, 0, 1, .003,&nbsp;.5,&nbsp;.1,&nbsp;3,&nbsp;1,&nbsp; 2,&nbsp; p3,&nbsp; 0,&nbsp; 1</td>				</tr>			</table>			</b><br>			</p>		</div>		<p><i>kband</i> &#151; formant bandwidth</p>		<p><i>kris, kdur, kdec</i> &#151; rise time, duration and decay time (in seconds) of the excitation envelope</p>		<div align="justify">			<p>These parameters control the shape and length of the <b>fof</b> granules. They are shaped in three segments: a rise, a middle decay, and a terminating decay. For very low fundamentals, these are perceived as an amplitude envelope, but with higher fundamentals (above 30 Hz), the granules merge together and these parameters effect the timbre of the sound. Note that these four parameters influence a new granule only at the time of its initialization and are fixed for its duration; later changes will affect only subsequent granules. We begin our examination with low frequencies.</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>k1</td>				<td><b>line</b></td>				<td>.003, p3, .1</td>				<td>; kris</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000, 2,&nbsp;300,&nbsp;0, 0, k1, .5, .1, 2, 1,&nbsp;2, p3</td>				<td></td>			</tr>		</table>		<br>		</b>Run this with a note length of 10 seconds. Notice how the attack of the envelope of the granules lengthens. The shape of this attack is determined by the forward shape of <i>ifnb </i>(here a sigmoid).</p>		<div align="justify">			<p>Now try changing <i>kband</i>:</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>k1</td>				<td><b>linseg</b></td>				<td>0,&nbsp;p3,&nbsp;10</td>				<td>; kband</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000, 2,&nbsp;300, 0, k1, .003, .5,&nbsp;.1,&nbsp;2, 1, 2,&nbsp;p3</td>				<td></td>			</tr>		</table>		</b><br>		</p>		<div align="justify">			<p>Following its rise, an excitation has a built-in exponential decay and <i>kband</i> determines its rate. The bigger <i>kband</i> the steeper the decay; zero means no decay. In the above example, the successive granules had increasingly fast decays.</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>k1</td>				<td><b>linseg</b></td>				<td>3, p3, .003</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000,&nbsp;2, 300,&nbsp;0, 0,&nbsp;.003,&nbsp;.4, k1, 2, 1,&nbsp;2, p3</td>			</tr>		</table>		</b><br>		</p>		<div align="justify">			<p>This demonstrates the operation of <i>kdec</i>. Because an exponential decay never reaches zero, it must be terminated gracefully. <i>kdur</i> is the overall duration (in seconds from the start of the excitation), and <i>kdec</i> is the length of the terminating decay. In the above example, the terminating decay starts very early in the first granules and then becomes progressively later. Note that <i>kband</i> is set to zero so that only the terminating decay is evident.</p>			<p>In the next example, the start time of the termination remains constant, but its length gets shorter:</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>k1</td>				<td><b>expon</b></td>				<td>.3,&nbsp;p3,&nbsp;.003</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000,&nbsp;2,&nbsp;300,&nbsp;0, 0, .003, .01 + k1,&nbsp;k1,&nbsp;2, 1, ,&nbsp;p3</td>			</tr>		</table>		</b><br>		</p>		<div align="justify">			<p>It may be surprising to find that, for higher fundamentals, the local envelope determines the spectral shape of the sound. Electronic and computer music has often shown how features of music we normally consider independent, such as pitch, timbre, rhythm, are, in fact, different aspects of the same thing. In general, the longer the local envelope segment, the narrower the band of partials around that frequency. <i>kband</i> determines the bandwidth of the formant region at -6dB, and <i>kris</i> controls the skirt width at -40dB. Increasing<i> kband</i> increases the local envelope's exponential decay rate, thus shortening it and increasing the &#151;6 dB spectral region. Increasing <i>kris</i> (the envelope attack time)</p>			<p>inversely makes the &#151;40 dB spectral region smaller.</p>			<p>The next example changes first the bandwidth, then the skirt width. You should be able to hear the difference.</p>		</div>		<p><b>		<table border="0" cellpadding="1" cellspacing="0" width="100%">			<tr>				<td>k1</td>				<td><b>linseg</b></td>				<td>100,&nbsp;p3/4,&nbsp;0, p3/4, 100, p3/2, 100</td>				<td>; kband</td>			</tr>			<tr>				<td>k2</td>				<td><b>linseg</b></td>				<td>.003,&nbsp;p3/2,&nbsp;.003, p3/4,&nbsp;.01, p3/4, .003</td>				<td>; kris</td>			</tr>			<tr>				<td>a1</td>				<td><b>fof</b></td>				<td>15000,&nbsp;100,&nbsp;440, 0, k1, k2, .02, .007, 3, 1, 2,&nbsp;p3</td>				<td></td>			</tr>		</table>		</b><br>		</p>		<div align="justify">			<p>In the first half of the note, <i>kris</i> remains constant while <i>kband</i> broadens, then narrows again. In the second half, <i>kband</i> is fixed while <i>kris</i> lengthens (narrowing the spectrum), then returns again.</p>			<p>Note that <i>kdur</i> and <i>kdec</i> don't really shape the spectrum, they simply tidy up the decay so as to prevent unwanted discontinuities which would distort the sound. For vocal imitations these parameters are typically set at .017 and .007 and left unchanged. With high (&quot;soprano&quot;) fundamentals it is possible to shorten these values and save computation time (reduce overlaps).</p>			<p><i>iolaps</i> &#151; number of overlap spaces</p>			<p>Granules are created at the rate of the fundamental frequency, and new granules are often created before earlier ones have finished, resulting in overlaps. The number of overlaps at any one time is given by <i>xfund * kdur</i>. For a typical bass note the calculation might be 200 * .018 = 3.6, and for a soprano note 660 * .015 = 9.9. <b>fof</b> needs at least this number (rounded up) of spaces in which to operate. The number can be over-estimated at no computation cost, and at only a small space cost. If there are insufficient overlap spaces during operation, the note will terminate.</p>			<p><i>ifna, ifnb</i> &#151; stored function tables</p>			<p>Identification numbers of two function tables (see the <b>fof </b>entry).</p>			<p><i>itotdur</i> &#151; total duration within which all granules in a note must be completed</p>			<p>So that incomplete granules are not cut off at the end of a note <b>fof</b> will not create new granules if they will not be completed by the time specified. Normally, given the value p3 (the note length), this parameter can be changed for special effect; <b>fof</b> will output zero after time <i>itotdur</i>.</p>			<p><i>iphs</i> &#151; initial phase (optional, defaulting to 0).</p>			<p>			<hr size="1">			Specifies the initial phase of the fundamental. Normally zero, but giving different <b>fof</b> generators different initial phases can be helpful in avoiding &quot;zeros&quot; in the spectrum.</div>	</body></html>